# 02. å¿«é€Ÿå¼€å§‹ï¼š5åˆ†é’Ÿåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ·±åº¦ä»£ç†

> ä»é›¶åˆ°ä¸€ï¼Œæ„å»ºèƒ½å¤Ÿè‡ªä¸»ç ”ç©¶å’Œæ’°å†™æŠ¥å‘Šçš„ AI åŠ©æ‰‹

## æœ¬æ–‡ç›®æ ‡

åœ¨è¿™ç¯‡æ•™ç¨‹ä¸­ï¼Œä½ å°†ï¼š
1. å®‰è£… DeepAgents åŠç›¸å…³ä¾èµ–
2. åˆ›å»ºä¸€ä¸ªå¸¦æœç´¢èƒ½åŠ›çš„ç ”ç©¶å‹ä»£ç†
3. ç†è§£ä»£ç†çš„è‡ªåŠ¨è§„åˆ’å’Œæ‰§è¡Œæµç¨‹
4. ä½“éªŒ `invoke` å’Œ `stream` ä¸¤ç§è°ƒç”¨æ–¹å¼

## å‰ç½®æ¡ä»¶

- Node.js 18+ ç¯å¢ƒ
- ä¸€ä¸ªæ¨¡å‹æä¾›å•†çš„ API Keyï¼ˆAnthropicã€OpenAI ç­‰ï¼‰
- ï¼ˆå¯é€‰ï¼‰Tavily API Keyï¼ˆç”¨äºç½‘ç»œæœç´¢ï¼‰

## ç¬¬ 1 æ­¥ï¼šå®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ npm
npm install deepagents langchain @langchain/core @langchain/tavily

# æˆ–ä½¿ç”¨ yarn
yarn add deepagents langchain @langchain/core @langchain/tavily

# æˆ–ä½¿ç”¨ pnpm
pnpm add deepagents langchain @langchain/core @langchain/tavily
```

**ä¾èµ–è¯´æ˜**ï¼š
- `deepagents`ï¼šDeepAgents SDK æ ¸å¿ƒåŒ…
- `langchain`ï¼šLangChain æ ¸å¿ƒåº“ï¼Œæä¾›å·¥å…·å®šä¹‰ç­‰èƒ½åŠ›
- `@langchain/core`ï¼šLangChain æ ¸å¿ƒæ¥å£
- `@langchain/tavily`ï¼šTavily æœç´¢é›†æˆï¼ˆå¯é€‰ï¼Œç”¨äºç½‘ç»œæœç´¢ï¼‰

## ç¬¬ 2 æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®æ¨¡å‹ API Keyï¼ˆé€‰æ‹©ä½ ä½¿ç”¨çš„æä¾›å•†ï¼‰
export ANTHROPIC_API_KEY="your-anthropic-api-key"
# æˆ–
export OPENAI_API_KEY="your-openai-api-key"

# è®¾ç½® Tavily API Keyï¼ˆç”¨äºç½‘ç»œæœç´¢ï¼‰
export TAVILY_API_KEY="your-tavily-api-key"
```

> ğŸ’¡ **æç¤º**ï¼šæ²¡æœ‰ Tavily API Keyï¼Ÿå¯ä»¥åœ¨ [tavily.com](https://tavily.com/) å…è´¹æ³¨å†Œè·å–ã€‚

## ç¬¬ 3 æ­¥ï¼šåˆ›å»ºæœç´¢å·¥å…·

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸ºä»£ç†åˆ›å»ºä¸€ä¸ª"æ‰‹"â€”â€”ä¸€ä¸ªå¯ä»¥æœç´¢äº’è”ç½‘çš„å·¥å…·ï¼š

```typescript
import { tool } from "langchain";
import { TavilySearch } from "@langchain/tavily";
import { z } from "zod";

const internetSearch = tool(
  async ({
    query,
    maxResults = 5,
    topic = "general",
    includeRawContent = false,
  }: {
    query: string;
    maxResults?: number;
    topic?: "general" | "news" | "finance";
    includeRawContent?: boolean;
  }) => {
    const tavilySearch = new TavilySearch({
      maxResults,
      tavilyApiKey: process.env.TAVILY_API_KEY,
      includeRawContent,
      topic,
    });
    return await tavilySearch._call({ query });
  },
  {
    name: "internet_search",
    description: "è¿è¡Œä¸€æ¬¡ç½‘é¡µæœç´¢ï¼Œè·å–äº’è”ç½‘ä¸Šçš„æœ€æ–°ä¿¡æ¯",
    schema: z.object({
      query: z.string().describe("æœç´¢æŸ¥è¯¢è¯"),
      maxResults: z
        .number()
        .optional()
        .default(5)
        .describe("è¿”å›ç»“æœçš„æœ€å¤§æ•°é‡"),
      topic: z
        .enum(["general", "news", "finance"])
        .optional()
        .default("general")
        .describe("æœç´¢ä¸»é¢˜ç±»åˆ«"),
      includeRawContent: z
        .boolean()
        .optional()
        .default(false)
        .describe("æ˜¯å¦åŒ…å«åŸå§‹å†…å®¹"),
    }),
  },
);
```

**ä»£ç è§£æ**ï¼š
- `tool()` å‡½æ•°æ¥è‡ª LangChainï¼Œç”¨äºåˆ›å»ºç»“æ„åŒ–å·¥å…·
- `schema` ä½¿ç”¨ Zod å®šä¹‰å‚æ•°ç±»å‹ï¼Œè®© LLM èƒ½æ­£ç¡®è°ƒç”¨
- `description` å‘Šè¯‰ LLM è¿™ä¸ªå·¥å…·æ˜¯å¹²ä»€ä¹ˆçš„

## ç¬¬ 4 æ­¥ï¼šåˆ›å»ºæ·±åº¦ä»£ç†

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶å‹ä»£ç†ï¼š

```typescript
import { createDeepAgent } from "deepagents";

const researchInstructions = `ä½ æ˜¯ä¸€åä¸“ä¸šç ”ç©¶å‘˜ã€‚ä½ çš„å·¥ä½œæ˜¯è¿›è¡Œå…¨é¢è°ƒç ”ï¼Œç„¶åæ’°å†™ä¸€ä»½æ‰“ç£¨å®Œå–„çš„æŠ¥å‘Šã€‚

ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªäº’è”ç½‘æœç´¢å·¥å…·ï¼Œä½œä¸ºæ”¶é›†ä¿¡æ¯çš„ä¸»è¦æ‰‹æ®µã€‚

## å·¥å…·è¯´æ˜

### internet_search
ä½¿ç”¨å®ƒå¯¹ç»™å®šæŸ¥è¯¢æ‰§è¡Œäº’è”ç½‘æœç´¢ã€‚ä½ å¯ä»¥æŒ‡å®šè¦è¿”å›çš„æœ€å¤§ç»“æœæ•°ã€ä¸»é¢˜ï¼Œä»¥åŠæ˜¯å¦åº”åŒ…å«åŸå§‹å†…å®¹ã€‚

## å·¥ä½œæµç¨‹

1. ç†è§£ç”¨æˆ·çš„ç ”ç©¶éœ€æ±‚
2. åˆ¶å®šç ”ç©¶è®¡åˆ’ï¼ˆä½¿ç”¨ write_todosï¼‰
3. æ‰§è¡Œæœç´¢æ”¶é›†ä¿¡æ¯
4. æ•´ç†å¹¶æ’°å†™æŠ¥å‘Š
`;

const agent = createDeepAgent({
  tools: [internetSearch],
  systemPrompt: researchInstructions,
});
```

**å…³é”®ç‚¹**ï¼š
- `createDeepAgent()` æ˜¯åˆ›å»ºæ·±åº¦ä»£ç†çš„æ ¸å¿ƒ API
- `systemPrompt` å®šä¹‰ä»£ç†çš„è§’è‰²å’Œè¡Œä¸ºå‡†åˆ™
- é™¤äº†æˆ‘ä»¬æä¾›çš„ `internetSearch`ï¼Œä»£ç†è¿˜è‡ªå¸¦ `write_todos`ã€`read_file`ã€`write_file` ç­‰å†…ç½®å·¥å…·

## ç¬¬ 5 æ­¥ï¼šè¿è¡Œä»£ç†

### æ–¹å¼ä¸€ï¼šinvokeï¼ˆåŒæ­¥è°ƒç”¨ï¼‰

```typescript
const result = await agent.invoke({
  messages: [{ role: "user", content: "ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿè¯·ç»™æˆ‘ä¸€ä»½è¯¦ç»†çš„è°ƒç ”æŠ¥å‘Šã€‚" }],
});

console.log(result.messages[result.messages.length - 1].content);
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
# LangGraph è°ƒç ”æŠ¥å‘Š

## æ¦‚è¿°
LangGraph æ˜¯ LangChain å›¢é˜Ÿæ¨å‡ºçš„...

## æ ¸å¿ƒç‰¹æ€§
1. æœ‰çŠ¶æ€çš„å¤šä»£ç†åä½œ
2. å¾ªç¯ä¸æ¡ä»¶åˆ†æ”¯æ”¯æŒ
3. æŒä¹…åŒ–ä¸æ£€æŸ¥ç‚¹
...
```

### æ–¹å¼äºŒï¼šstreamï¼ˆæµå¼è°ƒç”¨ï¼‰

å¦‚æœä½ æƒ³å®æ—¶è§‚å¯Ÿä»£ç†çš„æ‰§è¡Œè¿‡ç¨‹ï¼š

```typescript
const stream = await agent.stream({
  messages: [{ role: "user", content: "ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ" }],
});

for await (const chunk of stream) {
  console.log(chunk);
}
```

**æµå¼è¾“å‡ºçš„ä¼˜åŠ¿**ï¼š
- å®æ—¶è§‚å¯Ÿä»£ç†çš„æ€è€ƒå’Œè¡ŒåŠ¨
- å¯ä»¥çœ‹åˆ°å·¥å…·è°ƒç”¨çš„è¿‡ç¨‹
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼ˆä¸ç”¨ç­‰å¾…æœ€ç»ˆç»“æœï¼‰

## ç†è§£æ‰§è¡Œæµç¨‹

å½“ä½ å‘ä»£ç†å‘é€è¯·æ±‚åï¼Œå®ƒä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š

```
ç”¨æˆ·è¾“å…¥ "ç ”ç©¶ LangGraph"
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è§„åˆ’é˜¶æ®µ (write_todos)            â”‚
â”‚     - æœç´¢ LangGraph å®˜æ–¹æ–‡æ¡£          â”‚
â”‚     - äº†è§£æ ¸å¿ƒæ¦‚å¿µå’Œæ¶æ„               â”‚
â”‚     - æ”¶é›†ä½¿ç”¨æ¡ˆä¾‹                     â”‚
â”‚     - æ•´ç†å¹¶æ’°å†™æŠ¥å‘Š                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ‰§è¡Œé˜¶æ®µ (internet_search)        â”‚
â”‚     - æœç´¢ "LangGraph official docs"  â”‚
â”‚     - æœç´¢ "LangGraph architecture"   â”‚
â”‚     - æœç´¢ "LangGraph examples"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ä¸Šä¸‹æ–‡ç®¡ç† (write_file)           â”‚
â”‚     - å°†æœç´¢ç»“æœä¿å­˜åˆ°è™šæ‹Ÿæ–‡ä»¶         â”‚
â”‚     - é¿å…ä¸Šä¸‹æ–‡çª—å£æº¢å‡º               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ç»¼åˆç”Ÿæˆ                          â”‚
â”‚     - æ•´åˆæ‰€æœ‰ä¿¡æ¯                     â”‚
â”‚     - ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Š                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    æœ€ç»ˆæŠ¥å‘Šè¾“å‡º
```

**è¿™å°±æ˜¯ DeepAgent çš„é­”åŠ›**ï¼šä½ åªéœ€è¦å‘Šè¯‰å®ƒç›®æ ‡ï¼Œå®ƒä¼šè‡ªåŠ¨è§„åˆ’ã€æ‰§è¡Œã€ç®¡ç†ä¸Šä¸‹æ–‡ï¼Œæœ€åäº¤ä»˜ç»“æœã€‚

## å®Œæ•´ä»£ç ç¤ºä¾‹

```typescript
import { tool } from "langchain";
import { TavilySearch } from "@langchain/tavily";
import { createDeepAgent } from "deepagents";
import { z } from "zod";

const internetSearch = tool(
  async ({
    query,
    maxResults = 5,
    topic = "general",
    includeRawContent = false,
  }) => {
    const tavilySearch = new TavilySearch({
      maxResults,
      tavilyApiKey: process.env.TAVILY_API_KEY,
      includeRawContent,
      topic,
    });
    return await tavilySearch._call({ query });
  },
  {
    name: "internet_search",
    description: "è¿è¡Œä¸€æ¬¡ç½‘é¡µæœç´¢",
    schema: z.object({
      query: z.string().describe("æœç´¢æŸ¥è¯¢è¯"),
      maxResults: z.number().optional().default(5),
      topic: z.enum(["general", "news", "finance"]).optional().default("general"),
      includeRawContent: z.boolean().optional().default(false),
    }),
  },
);

const researchInstructions = `ä½ æ˜¯ä¸€åä¸“ä¸šç ”ç©¶å‘˜ã€‚
ä½ çš„å·¥ä½œæ˜¯è¿›è¡Œå…¨é¢è°ƒç ”ï¼Œç„¶åæ’°å†™ä¸€ä»½æ‰“ç£¨å®Œå–„çš„æŠ¥å‘Šã€‚
ä½ å¯ä»¥ä½¿ç”¨ internet_search å·¥å…·æ¥æœç´¢ä¿¡æ¯ã€‚`;

const agent = createDeepAgent({
  tools: [internetSearch],
  systemPrompt: researchInstructions,
});

async function main() {
  console.log("ğŸš€ å¯åŠ¨ç ”ç©¶ä»£ç†...\n");
  
  const result = await agent.invoke({
    messages: [{ role: "user", content: "ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿè¯·ç»™æˆ‘ä¸€ä»½ç®€è¦çš„è°ƒç ”æŠ¥å‘Šã€‚" }],
  });

  console.log("ğŸ“ ç ”ç©¶æŠ¥å‘Šï¼š\n");
  console.log(result.messages[result.messages.length - 1].content);
}

main().catch(console.error);
```

## ä¸ä½¿ç”¨æœç´¢å·¥å…·çš„ç®€åŒ–ç‰ˆæœ¬

å¦‚æœä½ æš‚æ—¶æ²¡æœ‰ Tavily API Keyï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ä»£ç†ï¼š

```typescript
import { createDeepAgent } from "deepagents";
import { tool } from "langchain";
import * as z from "zod";

const getWeather = tool(
  ({ city }) => {
    const weathers = {
      "åŒ—äº¬": "æ™´ï¼Œæ¸©åº¦ 25Â°C",
      "ä¸Šæµ·": "å¤šäº‘ï¼Œæ¸©åº¦ 28Â°C",
      "ä¸œäº¬": "å°é›¨ï¼Œæ¸©åº¦ 22Â°C",
    };
    return weathers[city] || `${city} å¤©æ°”æ•°æ®æš‚æ— `;
  },
  {
    name: "get_weather",
    description: "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”",
    schema: z.object({
      city: z.string().describe("åŸå¸‚åç§°"),
    }),
  },
);

const agent = createDeepAgent({
  tools: [getWeather],
  systemPrompt: "ä½ æ˜¯ä¸€ä¸ªå¤©æ°”åŠ©æ‰‹ï¼Œå¯ä»¥æŸ¥è¯¢å„åŸå¸‚çš„å¤©æ°”æƒ…å†µã€‚",
});

async function main() {
  const result = await agent.invoke({
    messages: [{ role: "user", content: "åŒ—äº¬å’Œä¸Šæµ·çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ" }],
  });
  
  console.log(result.messages[result.messages.length - 1].content);
}

main();
```

## å°ç»“

æ­å–œï¼ä½ å·²ç»æˆåŠŸåˆ›å»ºäº†ç¬¬ä¸€ä¸ªæ·±åº¦ä»£ç†ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹å…³é”®ç‚¹ï¼š

| æ­¥éª¤ | å†…å®¹ | å…³é”® API |
|------|------|---------|
| å®‰è£…ä¾èµ– | deepagents + langchain | npm install |
| åˆ›å»ºå·¥å…· | å®šä¹‰ä»£ç†å¯ç”¨çš„èƒ½åŠ› | `tool()` |
| åˆ›å»ºä»£ç† | ç»„åˆå·¥å…·å’Œç³»ç»Ÿæç¤ºè¯ | `createDeepAgent()` |
| è¿è¡Œä»£ç† | åŒæ­¥æˆ–æµå¼è°ƒç”¨ | `invoke()` / `stream()` |

**DeepAgent è‡ªåŠ¨å®Œæˆçš„å·¥ä½œ**ï¼š
- âœ… ä»»åŠ¡è§„åˆ’ï¼ˆwrite_todosï¼‰
- âœ… å·¥å…·è°ƒç”¨ï¼ˆä½ æä¾›çš„å·¥å…· + å†…ç½®å·¥å…·ï¼‰
- âœ… ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆæ–‡ä»¶ç³»ç»Ÿå·¥å…·ï¼‰
- âœ… ç»“æœç»¼åˆ

## ä¸‹ä¸€æ­¥

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢ç´¢ `createDeepAgent()` çš„æ‰€æœ‰é…ç½®é€‰é¡¹ï¼Œå­¦ä¹ å¦‚ä½•ï¼š
- åˆ‡æ¢ä¸åŒçš„æ¨¡å‹æä¾›å•†
- é…ç½®ä¸­é—´ä»¶æ‰©å±•èƒ½åŠ›
- æ·»åŠ å­ä»£ç†å®ç°ä»»åŠ¡å§”æ‰˜
- å¯ç”¨é•¿æœŸè®°å¿†

## å®è·µä»»åŠ¡

1. è¿è¡Œæœ¬æ–‡çš„å®Œæ•´ä»£ç ç¤ºä¾‹
2. ä¿®æ”¹ `systemPrompt`ï¼Œè®©ä»£ç†æˆä¸ºä¸€ä¸ª"æ–°é—»ç¼–è¾‘"æˆ–"ä»£ç å®¡æŸ¥å‘˜"
3. å°è¯•æ·»åŠ æ›´å¤šå·¥å…·ï¼Œæ¯”å¦‚è®¡ç®—å™¨ã€ç¿»è¯‘ç­‰
4. ä½¿ç”¨ `stream()` æ–¹å¼è°ƒç”¨ï¼Œè§‚å¯Ÿä»£ç†çš„æ‰§è¡Œè¿‡ç¨‹

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆæˆ‘çš„ä»£ç†æ²¡æœ‰ä½¿ç”¨ write_todosï¼Ÿ**

A: DeepAgent ä¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦è‡ªåŠ¨å†³å®šæ˜¯å¦éœ€è¦è§„åˆ’ã€‚ç®€å•ä»»åŠ¡å¯èƒ½ç›´æ¥æ‰§è¡Œã€‚

**Q: å¦‚ä½•æŸ¥çœ‹ä»£ç†è°ƒç”¨äº†å“ªäº›å·¥å…·ï¼Ÿ**

A: ä½¿ç”¨ `stream()` æ–¹å¼å¯ä»¥çœ‹åˆ°æ¯ä¸€æ­¥çš„å·¥å…·è°ƒç”¨ã€‚æˆ–è€…æ£€æŸ¥è¿”å›ç»“æœä¸­çš„ `messages` æ•°ç»„ã€‚

**Q: æ”¯æŒå“ªäº›æ¨¡å‹ï¼Ÿ**

A: æ”¯æŒæ‰€æœ‰å®ç°äº†å·¥å…·è°ƒç”¨çš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ Claudeã€GPT-4ã€Gemini ç­‰ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šè¯¦ç»†ä»‹ç»æ¨¡å‹é…ç½®ã€‚

## å‚è€ƒèµ„æº

- [DeepAgents å®˜æ–¹ç¤ºä¾‹](https://github.com/langchain-ai/deepagents/tree/main/examples)
- [LangChain å·¥å…·å®šä¹‰](https://docs.langchain.com/oss/javascript/langchain/tools)
- [Tavily æœç´¢ API](https://tavily.com/)
