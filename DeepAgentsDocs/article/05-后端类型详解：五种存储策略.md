# 05. åç«¯ç±»å‹è¯¦è§£ï¼šäº”ç§å­˜å‚¨ç­–ç•¥

> é€‰æ‹©æœ€é€‚åˆä½ åœºæ™¯çš„å­˜å‚¨åç«¯

## å¼•è¨€

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº† DeepAgents è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡ç†å¿µã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨äº”ç§å†…ç½®åç«¯ç±»å‹ï¼Œå¸®åŠ©ä½ æ ¹æ®åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„å­˜å‚¨ç­–ç•¥ã€‚

## åç«¯ç±»å‹é€ŸæŸ¥è¡¨

| åç«¯ç±»å‹ | æŒä¹…åŒ– | è·¨çº¿ç¨‹ | ä»£ç æ‰§è¡Œ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|---------|---------|
| StateBackend | âŒ | âŒ | âŒ | å•æ¬¡ä¼šè¯ã€ä¸´æ—¶ä»»åŠ¡ |
| FilesystemBackend | âœ… | - | âŒ | æœ¬åœ°å¼€å‘ã€æ–‡ä»¶æ“ä½œ |
| StoreBackend | âœ… | âœ… | âŒ | é•¿æœŸè®°å¿†ã€çŸ¥è¯†åº“ |
| LocalShellBackend | âœ… | - | âœ… | æœ¬åœ°å¼€å‘ï¼ˆéœ€è°¨æ…ï¼‰ |
| æ²™ç›’åç«¯ | âœ… | - | âœ… | å®‰å…¨ä»£ç æ‰§è¡Œ |

## 1. StateBackend - ä¸´æ—¶çŠ¶æ€å­˜å‚¨

### æ¦‚å¿µ

StateBackend æ˜¯ DeepAgents çš„**é»˜è®¤åç«¯**ï¼Œå°†æ–‡ä»¶å­˜å‚¨åœ¨ LangGraph çš„çŠ¶æ€ä¸­ã€‚

**ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒä¼šè®®ç™½æ¿ä¸Šçš„ç¬”è®°â€”â€”ä¼šè®®ç»“æŸåå°±æ“¦æ‰äº†ã€‚

### ç‰¹ç‚¹

âœ… **ä¼˜ç‚¹**ï¼š
- æ— éœ€é¢å¤–é…ç½®ï¼Œå¼€ç®±å³ç”¨
- é€‚åˆä¸´æ—¶ä»»åŠ¡å’Œè‰ç¨¿
- åŒä¸€çº¿ç¨‹å†…è‡ªåŠ¨é€šè¿‡ checkpoint æŒä¹…åŒ–

âŒ **é™åˆ¶**ï¼š
- çº¿ç¨‹ç»“æŸåæ•°æ®ä¸¢å¤±
- ä¸åŒçº¿ç¨‹ä¹‹é—´ä¸å…±äº«
- ä¸é€‚åˆé•¿æœŸå­˜å‚¨

### ä½¿ç”¨æ–¹å¼

```typescript
import { createDeepAgent } from "deepagents";
import { StateBackend } from "deepagents/backends";

// æ–¹å¼ä¸€ï¼šé»˜è®¤å°±æ˜¯ StateBackend
const agent1 = createDeepAgent();

// æ–¹å¼äºŒï¼šæ˜¾å¼æŒ‡å®š
const agent2 = createDeepAgent({
  backend: (rt) => new StateBackend(rt)
});
```

### æ•°æ®ç”Ÿå‘½å‘¨æœŸ

```
çº¿ç¨‹ 1                          çº¿ç¨‹ 2
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ write_file("/a.md") â”‚        â”‚ read_file("/a.md")  â”‚
â”‚       âœ… æˆåŠŸ        â”‚        â”‚       âŒ æ‰¾ä¸åˆ°      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â–¼                              â–¼
    State 1                        State 2
   (ç‹¬ç«‹çš„)                       (ç‹¬ç«‹çš„)
```

### é€‚ç”¨åœºæ™¯

- ğŸ¯ å•æ¬¡é—®ç­”ä»»åŠ¡
- ğŸ¯ ä¸´æ—¶è®¡ç®—å’Œåˆ†æ
- ğŸ¯ åŸå‹å¼€å‘å’Œæµ‹è¯•
- ğŸ¯ ä¸Šä¸‹æ–‡å¸è½½ï¼ˆå¤§å†…å®¹ä¸´æ—¶å­˜å‚¨ï¼‰

---

## 2. FilesystemBackend - æœ¬åœ°ç£ç›˜

### æ¦‚å¿µ

FilesystemBackend ç›´æ¥è¯»å†™æœ¬åœ°ç£ç›˜æ–‡ä»¶ï¼Œè®©ä»£ç†å¯ä»¥æ“ä½œçœŸå®çš„æ–‡ä»¶ç³»ç»Ÿã€‚

**ç”Ÿæ´»ç±»æ¯”**ï¼šä»£ç†å¯ä»¥ç›´æ¥è®¿é—®ä½ ç”µè„‘ä¸Šçš„æ–‡ä»¶å¤¹ã€‚

### âš ï¸ å®‰å…¨è­¦å‘Š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ é‡è¦å®‰å…¨æç¤º                                           â”‚
â”‚                                                            â”‚
â”‚  FilesystemBackend ä¼šèµ‹äºˆä»£ç†å¯¹æœ¬åœ°æ–‡ä»¶çš„è¯»å†™æƒé™ï¼         â”‚
â”‚                                                            â”‚
â”‚  é£é™©ï¼š                                                    â”‚
â”‚  â€¢ ä»£ç†å¯èƒ½è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼ˆå¯†é’¥ã€å‡­æ®ã€.envï¼‰                 â”‚
â”‚  â€¢ æ–‡ä»¶ä¿®æ”¹æ˜¯æ°¸ä¹…ä¸”ä¸å¯é€†çš„                                â”‚
â”‚  â€¢ ç»“åˆç½‘ç»œå·¥å…·å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²                            â”‚
â”‚                                                            â”‚
â”‚  å»ºè®®ï¼š                                                    â”‚
â”‚  â€¢ ä»…åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨                                        â”‚
â”‚  â€¢ å¯ç”¨ virtual_mode: true                                 â”‚
â”‚  â€¢ é…åˆäººæœºåä½œå®¡æ‰¹æ•æ„Ÿæ“ä½œ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```typescript
import { createDeepAgent } from "deepagents";
import { FilesystemBackend } from "deepagents/backends";

const agent = createDeepAgent({
  backend: new FilesystemBackend({
    rootDir: "/Users/me/projects/my-app",
    virtualMode: true  // å¼ºçƒˆå»ºè®®å¼€å¯ï¼
  })
});
```

### é…ç½®é€‰é¡¹

| é€‰é¡¹ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `rootDir` | string | æ ¹ç›®å½•ï¼ˆå¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼‰ |
| `virtualMode` | boolean | æ˜¯å¦å¯ç”¨è·¯å¾„é™åˆ¶ï¼ˆé»˜è®¤ falseï¼‰ |

### virtualMode çš„ä½œç”¨

```typescript
// virtualMode: falseï¼ˆä¸å®‰å…¨ï¼ï¼‰
// ä»£ç†å¯ä»¥è®¿é—®ï¼š
// - /Users/me/projects/my-app/src/
// - /Users/me/.ssh/id_rsa  â† å±é™©ï¼
// - /etc/passwd            â† å±é™©ï¼

// virtualMode: trueï¼ˆæ¨èï¼‰
// ä»£ç†åªèƒ½è®¿é—® rootDir å†…çš„è·¯å¾„
// - /Users/me/projects/my-app/src/  âœ…
// - /Users/me/.ssh/id_rsa           âŒ è¢«é˜»æ­¢
// - ../../../etc/passwd             âŒ è¢«é˜»æ­¢
```

### é€‚ç”¨åœºæ™¯

- ğŸ¯ æœ¬åœ°å¼€å‘ CLI å·¥å…·
- ğŸ¯ ç¼–ç åŠ©æ‰‹ï¼ˆæ“ä½œé¡¹ç›®æ–‡ä»¶ï¼‰
- ğŸ¯ CI/CD æµæ°´çº¿ï¼ˆéœ€åšå¥½å®‰å…¨é…ç½®ï¼‰

### ä¸é€‚ç”¨åœºæ™¯

- âŒ Web æœåŠ¡å™¨æˆ– API
- âŒ å¤šç§Ÿæˆ·ç³»ç»Ÿ
- âŒ å¤„ç†ä¸å—ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥

---

## 3. StoreBackend - è·¨çº¿ç¨‹æŒä¹…åŒ–

### æ¦‚å¿µ

StoreBackend ä½¿ç”¨ LangGraph çš„ BaseStore å®ç°è·¨çº¿ç¨‹çš„æŒä¹…åŒ–å­˜å‚¨ã€‚

**ç”Ÿæ´»ç±»æ¯”**ï¼šåƒä¸€ä¸ªäº‘ç«¯ç¬”è®°æœ¬ï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™æ‰“å¼€ï¼Œä¹‹å‰çš„ç¬”è®°éƒ½è¿˜åœ¨ã€‚

### æ ¸å¿ƒä¼˜åŠ¿

```
çº¿ç¨‹ 1                          çº¿ç¨‹ 2
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ write_file("/pref.md")  â”‚    â”‚ read_file("/pref.md")   â”‚
â”‚        âœ… æˆåŠŸ           â”‚    â”‚        âœ… æˆåŠŸ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                              â”‚
            â–¼                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           LangGraph Store           â”‚
         â”‚     (è·¨çº¿ç¨‹æŒä¹…åŒ–ï¼Œæ•°æ®å…±äº«)          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```typescript
import { createDeepAgent } from "deepagents";
import { StoreBackend } from "deepagents/backends";
import { InMemoryStore } from "@langchain/langgraph";

// å¼€å‘ç¯å¢ƒä½¿ç”¨ InMemoryStore
const store = new InMemoryStore();

const agent = createDeepAgent({
  backend: (rt) => new StoreBackend(rt),
  store: store
});
```

### Store å®ç°é€‰æ‹©

| Store ç±»å‹ | åœºæ™¯ | ç‰¹ç‚¹ |
|------------|------|------|
| `InMemoryStore` | å¼€å‘æµ‹è¯• | é‡å¯åæ•°æ®ä¸¢å¤± |
| `PostgresStore` | ç”Ÿäº§ç¯å¢ƒ | çœŸæ­£çš„æŒä¹…åŒ– |
| LangSmith è‡ªåŠ¨é…ç½® | äº‘éƒ¨ç½² | æ— éœ€æ‰‹åŠ¨é…ç½® |

```typescript
// ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ PostgresStore
import { PostgresStore } from "@langchain/langgraph-checkpoint-postgres";

const store = new PostgresStore({
  connectionString: process.env.DATABASE_URL
});

const agent = createDeepAgent({
  backend: (rt) => new StoreBackend(rt),
  store: store
});
```

### é€‚ç”¨åœºæ™¯

- ğŸ¯ é•¿æœŸè®°å¿†ï¼ˆç”¨æˆ·åå¥½ã€å­¦ä¹ åˆ°çš„çŸ¥è¯†ï¼‰
- ğŸ¯ è·¨ä¼šè¯çš„ç ”ç©¶é¡¹ç›®
- ğŸ¯ çŸ¥è¯†åº“ç§¯ç´¯
- ğŸ¯ éƒ¨ç½²åˆ° LangSmith

---

## 4. LocalShellBackend - æœ¬åœ° Shell

### æ¦‚å¿µ

LocalShellBackend åœ¨ FilesystemBackend åŸºç¡€ä¸Šå¢åŠ äº† `execute` å·¥å…·ï¼Œå…è®¸ä»£ç†æ‰§è¡Œ Shell å‘½ä»¤ã€‚

**ç”Ÿæ´»ç±»æ¯”**ï¼šä¸ä»…èƒ½çœ‹ä½ çš„æ–‡ä»¶ï¼Œè¿˜èƒ½å¸®ä½ è¿è¡Œå‘½ä»¤ã€‚

### âš ï¸âš ï¸âš ï¸ ä¸¥é‡å®‰å…¨è­¦å‘Š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš¨ æåº¦å±é™© - è¯·åŠ¡å¿…ç†è§£é£é™©                               â”‚
â”‚                                                            â”‚
â”‚  LocalShellBackend å…è®¸ä»£ç†æ‰§è¡Œä»»æ„ Shell å‘½ä»¤ï¼            â”‚
â”‚                                                            â”‚
â”‚  ä»£ç†å¯ä»¥ï¼š                                                 â”‚
â”‚  â€¢ ä»¥ä½ çš„ç”¨æˆ·æƒé™æ‰§è¡Œä»»ä½•å‘½ä»¤                               â”‚
â”‚  â€¢ è¯»å–ä»»ä½•å¯è®¿é—®æ–‡ä»¶                                       â”‚
â”‚  â€¢ ä¿®æ”¹æˆ–åˆ é™¤æ–‡ä»¶                                          â”‚
â”‚  â€¢ å®‰è£…è½¯ä»¶ã€å‘èµ·ç½‘ç»œè¯·æ±‚                                   â”‚
â”‚  â€¢ æ¶ˆè€—æ— é™ CPUã€å†…å­˜ã€ç£ç›˜                                 â”‚
â”‚                                                            â”‚
â”‚  ä»…åœ¨ä»¥ä¸‹æƒ…å†µä½¿ç”¨ï¼š                                         â”‚
â”‚  âœ… æœ¬åœ°å¼€å‘ç¯å¢ƒ                                            â”‚
â”‚  âœ… ä½ å®Œå…¨ä¿¡ä»»ä»£ç†çš„è¡Œä¸º                                    â”‚
â”‚  âœ… é…åˆäººæœºåä½œå®¡æ‰¹                                        â”‚
â”‚                                                            â”‚
â”‚  ç»å¯¹ä¸è¦ç”¨äºï¼š                                             â”‚
â”‚  âŒ ç”Ÿäº§ç¯å¢ƒ                                                â”‚
â”‚  âŒ Web æœåŠ¡å™¨æˆ– API                                        â”‚
â”‚  âŒ å¤„ç†ä¸å—ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ–¹å¼

```typescript
import { createDeepAgent } from "deepagents";
import { LocalShellBackend } from "deepagents/backends";
import { MemorySaver } from "@langchain/langgraph";

const checkpointer = new MemorySaver();

const agent = createDeepAgent({
  backend: new LocalShellBackend({
    rootDir: ".",
    env: { PATH: "/usr/bin:/bin" },
    timeout: 120,           // å‘½ä»¤è¶…æ—¶ï¼ˆç§’ï¼‰
    maxOutputBytes: 100000  // è¾“å‡ºé™åˆ¶
  }),
  interruptOn: {
    execute: true  // å¼ºçƒˆå»ºè®®ï¼šæ‰€æœ‰å‘½ä»¤æ‰§è¡Œå‰éœ€äººå·¥å®¡æ‰¹
  },
  checkpointer
});
```

### é…ç½®é€‰é¡¹

| é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `rootDir` | å¿…å¡« | å·¥ä½œç›®å½• |
| `env` | `{}` | ç¯å¢ƒå˜é‡ |
| `inheritEnv` | false | æ˜¯å¦ç»§æ‰¿ç³»ç»Ÿç¯å¢ƒå˜é‡ |
| `timeout` | 120 | å‘½ä»¤è¶…æ—¶ï¼ˆç§’ï¼‰ |
| `maxOutputBytes` | 100000 | è¾“å‡ºå¤§å°é™åˆ¶ |

### execute å·¥å…·

```typescript
// ä»£ç†å¯ä»¥è¿™æ ·è°ƒç”¨
execute("npm install")
execute("npm run build")
execute("git status")

// è¿”å›ç»“æœ
{
  stdout: "...",
  stderr: "...",
  exitCode: 0
}
```

### é€‚ç”¨åœºæ™¯

- ğŸ¯ æœ¬åœ°ç¼–ç åŠ©æ‰‹
- ğŸ¯ å¼€å‘è¿‡ç¨‹ä¸­çš„å¿«é€Ÿè¿­ä»£
- ğŸ¯ **ä»…é™ä½ å®Œå…¨ä¿¡ä»»ä»£ç†çš„åœºæ™¯**

---

## 5. æ²™ç›’åç«¯ - å®‰å…¨ä»£ç æ‰§è¡Œ

### æ¦‚å¿µ

æ²™ç›’åç«¯åœ¨éš”ç¦»çš„ç¯å¢ƒä¸­æ‰§è¡Œä»£ç ï¼Œä¿æŠ¤å®¿ä¸»ç³»ç»Ÿä¸å—å½±å“ã€‚

**ç”Ÿæ´»ç±»æ¯”**ï¼šç»™ä»£ç†ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿæœºï¼Œè®©å®ƒåœ¨é‡Œé¢è‡ªç”±æ“ä½œã€‚

### å¯ç”¨çš„æ²™ç›’æä¾›å•†

| æä¾›å•† | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|--------|------|---------|
| Modal | äº‘ç«¯å®¹å™¨ï¼ŒæŒ‰éœ€è®¡è´¹ | ç”Ÿäº§ç¯å¢ƒ |
| Daytona | å¼€å‘ç¯å¢ƒç®¡ç† | å›¢é˜Ÿåä½œ |
| Deno | è½»é‡çº§ JS/TS æ²™ç›’ | å¿«é€ŸåŸå‹ |
| Node VFS | æœ¬åœ°è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ | å¼€å‘æµ‹è¯• |

### ä½¿ç”¨ç¤ºä¾‹ï¼ˆDenoï¼‰

```typescript
import { createDeepAgent } from "deepagents";
import { DenoSandbox } from "@langchain/deno";

const sandbox = await DenoSandbox.create({
  memoryMb: 1024,
  lifetime: "10m"
});

try {
  const agent = createDeepAgent({
    backend: sandbox,
    systemPrompt: "ä½ æ˜¯ä¸€ä¸ª JavaScript ç¼–ç åŠ©æ‰‹ï¼Œå¯ä»¥åœ¨æ²™ç›’ä¸­æ‰§è¡Œä»£ç ã€‚"
  });

  const result = await agent.invoke({
    messages: [{
      role: "user",
      content: "åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨å¹¶æµ‹è¯•å®ƒ"
    }]
  });
} finally {
  await sandbox.close();
}
```

### æ²™ç›’ vs LocalShellBackend

| ç‰¹æ€§ | LocalShellBackend | æ²™ç›’åç«¯ |
|------|-------------------|---------|
| æ‰§è¡Œç¯å¢ƒ | å®¿ä¸»æœº | éš”ç¦»å®¹å™¨ |
| å®‰å…¨æ€§ | âš ï¸ å±é™© | âœ… å®‰å…¨ |
| æ€§èƒ½ | å¿« | ç¨æ…¢ |
| é€‚ç”¨åœºæ™¯ | æœ¬åœ°å¼€å‘ | ç”Ÿäº§ç¯å¢ƒ |

### å®‰å…¨æœ€ä½³å®è·µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ æ²™ç›’å®‰å…¨åŸåˆ™                                            â”‚
â”‚                                                            â”‚
â”‚  1. æ°¸è¿œä¸è¦æŠŠå¯†é’¥æ”¾å…¥æ²™ç›’                                  â”‚
â”‚  2. é™åˆ¶æ²™ç›’çš„ç½‘ç»œè®¿é—®                                      â”‚
â”‚  3. è®¾ç½®èµ„æºé™åˆ¶ï¼ˆå†…å­˜ã€CPUã€æ—¶é—´ï¼‰                         â”‚
â”‚  4. å®šæœŸæ¸…ç†æ²™ç›’ç¯å¢ƒ                                        â”‚
â”‚  5. è®°å½•å’Œå®¡è®¡æ²™ç›’å†…çš„æ“ä½œ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åç«¯é€‰æ‹©å†³ç­–æ ‘

```
å¼€å§‹
  â”‚
  â”œâ”€ éœ€è¦æ‰§è¡Œä»£ç ï¼Ÿ
  â”‚    â”‚
  â”‚    â”œâ”€ æ˜¯ â”€â”€â”€â”€â”€â”¬â”€ ç”Ÿäº§ç¯å¢ƒï¼Ÿâ”€â”€â”€ æ˜¯ â”€â”€â†’ æ²™ç›’åç«¯
  â”‚    â”‚          â”‚
  â”‚    â”‚          â””â”€ æœ¬åœ°å¼€å‘ï¼Ÿâ”€â”€â”€ æ˜¯ â”€â”€â†’ LocalShellBackend
  â”‚    â”‚                                 (é…åˆ interruptOn)
  â”‚    â”‚
  â”‚    â””â”€ å¦ â”€â”€â”€â”€â†’ éœ€è¦è·¨çº¿ç¨‹æŒä¹…åŒ–ï¼Ÿ
  â”‚                  â”‚
  â”‚                  â”œâ”€ æ˜¯ â”€â”€â†’ StoreBackend
  â”‚                  â”‚
  â”‚                  â””â”€ å¦ â”€â†’ éœ€è¦æ“ä½œæœ¬åœ°æ–‡ä»¶ï¼Ÿ
  â”‚                             â”‚
  â”‚                             â”œâ”€ æ˜¯ â”€â”€â†’ FilesystemBackend
  â”‚                             â”‚
  â”‚                             â””â”€ å¦ â”€â”€â†’ StateBackend (é»˜è®¤)
  â”‚
  â””â”€ éœ€è¦æ··åˆå­˜å‚¨ï¼Ÿâ”€â”€â”€ æ˜¯ â”€â”€â†’ CompositeBackend (ä¸‹ç¯‡è¯¦è§£)
```

## å®è·µç¤ºä¾‹ï¼šé€‰æ‹©åˆé€‚çš„åç«¯

### åœºæ™¯ä¸€ï¼šç®€å•é—®ç­”æœºå™¨äºº

```typescript
// ä½¿ç”¨é»˜è®¤çš„ StateBackend å³å¯
const chatBot = createDeepAgent({
  systemPrompt: "ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„èŠå¤©åŠ©æ‰‹"
});
```

### åœºæ™¯äºŒï¼šæœ¬åœ°ç¼–ç åŠ©æ‰‹

```typescript
import { FilesystemBackend } from "deepagents/backends";

const codingAssistant = createDeepAgent({
  backend: new FilesystemBackend({
    rootDir: process.cwd(),
    virtualMode: true
  }),
  systemPrompt: "ä½ æ˜¯ä¸€ä¸ªç¼–ç åŠ©æ‰‹ï¼Œå¯ä»¥è¯»å–å’Œä¿®æ”¹é¡¹ç›®æ–‡ä»¶"
});
```

### åœºæ™¯ä¸‰ï¼šå¸¦è®°å¿†çš„ä¸ªäººåŠ©ç†

```typescript
import { StoreBackend } from "deepagents/backends";
import { InMemoryStore } from "@langchain/langgraph";

const personalAssistant = createDeepAgent({
  backend: (rt) => new StoreBackend(rt),
  store: new InMemoryStore(),
  systemPrompt: `ä½ æ˜¯ä¸€ä¸ªä¸ªäººåŠ©ç†ã€‚
    è®°ä½ç”¨æˆ·çš„åå¥½ï¼Œä¿å­˜åˆ° /preferences.md
    è®°ä½é‡è¦äº‹é¡¹ï¼Œä¿å­˜åˆ° /notes/`
});
```

### åœºæ™¯å››ï¼šå®‰å…¨çš„ä»£ç æ‰§è¡Œå¹³å°

```typescript
import { DenoSandbox } from "@langchain/deno";

const sandbox = await DenoSandbox.create({ memoryMb: 512 });

const codeRunner = createDeepAgent({
  backend: sandbox,
  systemPrompt: "ä½ å¯ä»¥æ‰§è¡Œç”¨æˆ·æä¾›çš„ä»£ç ï¼Œåœ¨å®‰å…¨çš„æ²™ç›’ç¯å¢ƒä¸­è¿è¡Œ"
});
```

## å°ç»“

æœ¬æ–‡ä»‹ç»äº† DeepAgents çš„äº”ç§åç«¯ç±»å‹ï¼š

| åç«¯ | ä¸€å¥è¯æ€»ç»“ | å…³é”®åœºæ™¯ |
|------|-----------|---------|
| StateBackend | ä¸´æ—¶å­˜å‚¨ï¼Œçº¿ç¨‹å†…æœ‰æ•ˆ | å•æ¬¡ä»»åŠ¡ã€é»˜è®¤é€‰æ‹© |
| FilesystemBackend | æœ¬åœ°ç£ç›˜è¯»å†™ | ç¼–ç åŠ©æ‰‹ã€æœ¬åœ°å¼€å‘ |
| StoreBackend | è·¨çº¿ç¨‹æŒä¹…åŒ– | é•¿æœŸè®°å¿†ã€çŸ¥è¯†åº“ |
| LocalShellBackend | æœ¬åœ°æ‰§è¡Œå‘½ä»¤ | å¼€å‘å·¥å…·ï¼ˆéœ€è°¨æ…ï¼‰ |
| æ²™ç›’åç«¯ | å®‰å…¨ä»£ç æ‰§è¡Œ | ç”Ÿäº§ç¯å¢ƒä»£ç è¿è¡Œ |

**é€‰æ‹©åŸåˆ™**ï¼š
- ğŸ”’ å®‰å…¨ç¬¬ä¸€ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ²™ç›’
- ğŸ’¾ æŒ‰éœ€æŒä¹…åŒ–ï¼šé•¿æœŸæ•°æ®ç”¨ StoreBackend
- âš¡ ç®€å•ä¼˜å…ˆï¼šé»˜è®¤ StateBackend å¤Ÿç”¨å°±ä¸æ¢

## ä¸‹ä¸€æ­¥

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹  **CompositeBackend**â€”â€”å¦‚ä½•ç»„åˆå¤šä¸ªåç«¯ï¼Œå®ç°çµæ´»çš„è·¯ç”±ç­–ç•¥ã€‚

## å®è·µä»»åŠ¡

1. åˆ›å»ºä¸€ä¸ªä½¿ç”¨ FilesystemBackend çš„ä»£ç†ï¼Œè®©å®ƒèƒ½è¯»å†™ä½ é¡¹ç›®ä¸­çš„æ–‡ä»¶
2. ä½¿ç”¨ StoreBackend å®ç°ä¸€ä¸ªèƒ½"è®°ä½"ç”¨æˆ·åå¥½çš„åŠ©æ‰‹
3. å¦‚æœæœ‰æ¡ä»¶ï¼Œå°è¯•é…ç½®ä¸€ä¸ªæ²™ç›’åç«¯

## å‚è€ƒèµ„æº

- [åç«¯å®˜æ–¹æ–‡æ¡£](https://docs.langchain.com/oss/javascript/deepagents/backends)
- [æ²™ç›’æ–‡æ¡£](https://docs.langchain.com/oss/javascript/deepagents/sandboxes)
- [LangGraph Store](https://docs.langchain.com/oss/javascript/langgraph/persistence)
