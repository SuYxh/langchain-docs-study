# 03. è‡ªå®šä¹‰é…ç½®ï¼šæ‰“é€ ä¸“å±ä»£ç†

> æ·±å…¥ createDeepAgent() çš„ä¹å¤§é…ç½®é¡¹

## å¼•è¨€

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç”¨æœ€ç®€å•çš„é…ç½®åˆ›å»ºäº†ç¬¬ä¸€ä¸ªæ·±åº¦ä»£ç†ã€‚ä½† `createDeepAgent()` çš„èƒ½åŠ›è¿œä¸æ­¢äºæ­¤â€”â€”å®ƒæä¾›äº†ä¹å¤§é…ç½®é¡¹ï¼Œè®©ä½ èƒ½å¤Ÿç²¾ç»†æ§åˆ¶ä»£ç†çš„æ¯ä¸€ä¸ªæ–¹é¢ã€‚

```typescript
const agent = createDeepAgent({
  name?: string,              // ä»£ç†åç§°
  model?: string | Model,     // æ¨¡å‹é…ç½®
  tools?: Tool[],             // è‡ªå®šä¹‰å·¥å…·
  systemPrompt?: string,      // ç³»ç»Ÿæç¤ºè¯
  middleware?: Middleware[],  // ä¸­é—´ä»¶
  subagents?: SubAgent[],     // å­ä»£ç†
  backend?: Backend,          // æ–‡ä»¶ç³»ç»Ÿåç«¯
  interruptOn?: InterruptConfig, // äººæœºåä½œ
  skills?: string[],          // æŠ€èƒ½
  memory?: string[],          // è®°å¿†æ–‡ä»¶
  responseFormat?: Schema,    // ç»“æ„åŒ–è¾“å‡º
});
```

æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥äº†è§£æ¯ä¸€ä¸ªé…ç½®é¡¹ã€‚

## é…ç½®æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     createDeepAgent()                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    model    â”‚  â”‚    tools    â”‚  â”‚     systemPrompt        â”‚ â”‚
â”‚  â”‚  (å¤§è„‘)     â”‚  â”‚   (åŒæ‰‹)    â”‚  â”‚    (èŒä¸šåŸ¹è®­)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  middleware â”‚  â”‚  subagents  â”‚  â”‚       backend           â”‚ â”‚
â”‚  â”‚ (èƒ½åŠ›å¢å¼º)  â”‚  â”‚  (åŠ©ç†å›¢é˜Ÿ) â”‚  â”‚     (æ¡£æ¡ˆç³»ç»Ÿ)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ interruptOn â”‚  â”‚   skills    â”‚  â”‚        memory           â”‚ â”‚
â”‚  â”‚ (å®¡æ‰¹æµç¨‹)  â”‚  â”‚ (ä¸“ä¸šæŠ€èƒ½)  â”‚  â”‚      (ç»éªŒè®°å¿†)         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1. model - é€‰æ‹©ä»£ç†çš„"å¤§è„‘"

### é»˜è®¤æ¨¡å‹

DeepAgents é»˜è®¤ä½¿ç”¨ `claude-sonnet-4-5-20250929`ï¼ˆAnthropic çš„ Claude Sonnet æ¨¡å‹ï¼‰ã€‚

### ä½¿ç”¨å­—ç¬¦ä¸²æ ‡è¯†ç¬¦

æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ `provider:model` æ ¼å¼çš„å­—ç¬¦ä¸²ï¼š

```typescript
import { createDeepAgent } from "deepagents";

const agent = createDeepAgent({
  model: "gpt-4.1",  // ä½¿ç”¨ OpenAI GPT-4
});

const agent2 = createDeepAgent({
  model: "claude-sonnet-4-5-20250929",  // ä½¿ç”¨ Anthropic Claude
});

const agent3 = createDeepAgent({
  model: "google-genai:gemini-2.5-flash-lite",  // ä½¿ç”¨ Google Gemini
});
```

### ä½¿ç”¨æ¨¡å‹å®ä¾‹

å¦‚æœéœ€è¦æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¯ä»¥ç›´æ¥ä¼ å…¥æ¨¡å‹å®ä¾‹ï¼š

```typescript
import { createDeepAgent } from "deepagents";
import { ChatOpenAI } from "@langchain/openai";
import { ChatAnthropic } from "@langchain/anthropic";

const agent = createDeepAgent({
  model: new ChatOpenAI({
    model: "gpt-4.1",
    apiKey: "your-api-key",
    temperature: 0,
    maxTokens: 4096,
  }),
});

const agent2 = createDeepAgent({
  model: new ChatAnthropic({
    model: "claude-sonnet-4-5-20250929",
    apiKey: "your-api-key",
    temperature: 0,
  }),
});
```

### æ”¯æŒçš„æ¨¡å‹æä¾›å•†

| æä¾›å•† | å®‰è£…åŒ… | å­—ç¬¦ä¸²å‰ç¼€ |
|--------|--------|-----------|
| OpenAI | `@langchain/openai` | `openai:` æˆ–ç›´æ¥ä½¿ç”¨æ¨¡å‹å |
| Anthropic | `@langchain/anthropic` | `anthropic:` æˆ–ç›´æ¥ä½¿ç”¨æ¨¡å‹å |
| Google Gemini | `@langchain/google-genai` | `google-genai:` |
| Azure OpenAI | `@langchain/openai` | `azure_openai:` |
| AWS Bedrock | `@langchain/aws` | `bedrock:` |

### æ¨¡å‹é€‰æ‹©å»ºè®®

| åœºæ™¯ | æ¨èæ¨¡å‹ | åŸå›  |
|------|---------|------|
| å¤æ‚æ¨ç†ä»»åŠ¡ | Claude Sonnet / GPT-4 | å¼ºå¤§çš„æ¨ç†èƒ½åŠ› |
| å¿«é€Ÿå“åº”åœºæ™¯ | GPT-4o-mini / Claude Haiku | ä½å»¶è¿Ÿ |
| æˆæœ¬æ•æ„Ÿåœºæ™¯ | Gemini Flash | æ€§ä»·æ¯”é«˜ |
| ä¼ä¸šåˆè§„éœ€æ±‚ | Azure OpenAI | æ•°æ®é©»ç•™ä¿éšœ |

## 2. tools - èµ‹äºˆä»£ç†"åŒæ‰‹"

### å†…ç½®å·¥å…·

DeepAgents è‡ªå¸¦ä»¥ä¸‹å†…ç½®å·¥å…·ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼š

| å·¥å…· | åŠŸèƒ½ |
|------|------|
| `write_todos` | è§„åˆ’å’Œè·Ÿè¸ªä»»åŠ¡ |
| `ls` | åˆ—å‡ºç›®å½•å†…å®¹ |
| `read_file` | è¯»å–æ–‡ä»¶ |
| `write_file` | å†™å…¥æ–‡ä»¶ |
| `edit_file` | ç¼–è¾‘æ–‡ä»¶ |

### æ·»åŠ è‡ªå®šä¹‰å·¥å…·

```typescript
import { tool } from "langchain";
import { createDeepAgent } from "deepagents";
import * as z from "zod";

const calculator = tool(
  ({ expression }) => {
    try {
      return String(eval(expression));
    } catch {
      return "è®¡ç®—é”™è¯¯";
    }
  },
  {
    name: "calculator",
    description: "æ‰§è¡Œæ•°å­¦è®¡ç®—",
    schema: z.object({
      expression: z.string().describe("æ•°å­¦è¡¨è¾¾å¼ï¼Œå¦‚ 2 + 2"),
    }),
  }
);

const translator = tool(
  async ({ text, targetLang }) => {
    // å®é™…åœºæ™¯ä¸­è°ƒç”¨ç¿»è¯‘ API
    return `[ç¿»è¯‘æˆ${targetLang}]: ${text}`;
  },
  {
    name: "translator",
    description: "å°†æ–‡æœ¬ç¿»è¯‘æˆç›®æ ‡è¯­è¨€",
    schema: z.object({
      text: z.string().describe("è¦ç¿»è¯‘çš„æ–‡æœ¬"),
      targetLang: z.string().describe("ç›®æ ‡è¯­è¨€ï¼Œå¦‚ English, Japanese"),
    }),
  }
);

const agent = createDeepAgent({
  tools: [calculator, translator],
  systemPrompt: "ä½ æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥è¿›è¡Œè®¡ç®—å’Œç¿»è¯‘ã€‚"
});
```

### å·¥å…·è®¾è®¡æœ€ä½³å®è·µ

1. **æ¸…æ™°çš„æè¿°**ï¼š`description` è¦å‡†ç¡®æè¿°å·¥å…·ç”¨é€”ï¼ŒLLM é å®ƒå†³å®šä½•æ—¶è°ƒç”¨
2. **å®Œæ•´çš„å‚æ•°è¯´æ˜**ï¼šæ¯ä¸ªå‚æ•°éƒ½è¦æœ‰ `.describe()`
3. **é”™è¯¯å¤„ç†**ï¼šå·¥å…·å†…éƒ¨è¦å¤„ç†å¼‚å¸¸ï¼Œè¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯
4. **å•ä¸€èŒè´£**ï¼šä¸€ä¸ªå·¥å…·åªåšä¸€ä»¶äº‹

## 3. systemPrompt - å®šä¹‰ä»£ç†çš„"èŒä¸š"

ç³»ç»Ÿæç¤ºè¯å†³å®šäº†ä»£ç†çš„è§’è‰²å®šä½å’Œè¡Œä¸ºå‡†åˆ™ã€‚

### åŸºç¡€ç”¨æ³•

```typescript
const agent = createDeepAgent({
  systemPrompt: "ä½ æ˜¯ä¸€åä¸“ä¸šçš„æ•°æ®åˆ†æå¸ˆã€‚ä½ æ“…é•¿å¤„ç†å’Œåˆ†ææ•°æ®ï¼Œç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šã€‚"
});
```

### ç»“æ„åŒ–æç¤ºè¯æ¨¡æ¿

```typescript
const systemPrompt = `
# è§’è‰²å®šä¹‰
ä½ æ˜¯ä¸€åèµ„æ·±çš„ TypeScript ä»£ç å®¡æŸ¥ä¸“å®¶ã€‚

# æ ¸å¿ƒèŒè´£
1. å®¡æŸ¥ä»£ç è´¨é‡å’Œæœ€ä½³å®è·µ
2. å‘ç°æ½œåœ¨çš„ bug å’Œå®‰å…¨é—®é¢˜
3. æä¾›æ”¹è¿›å»ºè®®

# å®¡æŸ¥æ ‡å‡†
- ç±»å‹å®‰å…¨æ€§
- é”™è¯¯å¤„ç†å®Œæ•´æ€§
- ä»£ç å¯è¯»æ€§
- æ€§èƒ½è€ƒé‡

# è¾“å‡ºæ ¼å¼
å¯¹æ¯ä¸ªé—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š
- ğŸ”´ ä¸¥é‡é—®é¢˜ï¼š[æè¿°]
- ğŸŸ¡ å»ºè®®æ”¹è¿›ï¼š[æè¿°]
- ğŸŸ¢ ä¼˜ç‚¹ï¼š[æè¿°]

# æ³¨æ„äº‹é¡¹
- ä¿æŒå®¢è§‚ä¸“ä¸š
- è§£é‡Šé—®é¢˜åŸå› ï¼Œè€Œä¸åªæ˜¯æŒ‡å‡ºé—®é¢˜
- æä¾›å¯æ“ä½œçš„ä¿®å¤å»ºè®®
`;

const codeReviewer = createDeepAgent({
  systemPrompt,
  tools: [readFileTool, searchCodeTool],
});
```

### æç¤ºè¯è®¾è®¡æŠ€å·§

| æŠ€å·§ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| è§’è‰²è®¾å®š | æ˜ç¡®ä»£ç†çš„èº«ä»½ | "ä½ æ˜¯ä¸€åèµ„æ·±å‰ç«¯å·¥ç¨‹å¸ˆ" |
| è¡Œä¸ºå‡†åˆ™ | å®šä¹‰å·¥ä½œæ–¹å¼ | "åœ¨ä¿®æ”¹ä»£ç å‰ï¼Œå…ˆç†è§£ç°æœ‰æ¶æ„" |
| è¾“å‡ºæ ¼å¼ | è§„èŒƒå“åº”ç»“æ„ | "ä½¿ç”¨ Markdown è¡¨æ ¼å±•ç¤ºå¯¹æ¯”" |
| è¾¹ç•Œé™åˆ¶ | æ˜ç¡®ä¸åšä»€ä¹ˆ | "ä¸è¦ä¿®æ”¹é…ç½®æ–‡ä»¶" |

## 4. middleware - æ‰©å±•ä»£ç†èƒ½åŠ›

ä¸­é—´ä»¶æ˜¯ DeepAgents çš„"èƒ½åŠ›å¢å¼ºåŒ…"ï¼Œå¯ä»¥åœ¨ä»£ç†æ‰§è¡Œçš„å„ä¸ªé˜¶æ®µä»‹å…¥ã€‚

### å†…ç½®ä¸­é—´ä»¶

DeepAgents é»˜è®¤å¯ç”¨ä»¥ä¸‹ä¸­é—´ä»¶ï¼š

| ä¸­é—´ä»¶ | åŠŸèƒ½ |
|--------|------|
| `TodoListMiddleware` | ä»»åŠ¡è§„åˆ’å’Œè·Ÿè¸ª |
| `FilesystemMiddleware` | æ–‡ä»¶ç³»ç»Ÿæ“ä½œ |
| `SubAgentMiddleware` | å­ä»£ç†ç®¡ç† |
| `SummarizationMiddleware` | é•¿å¯¹è¯å‹ç¼© |
| `AnthropicPromptCachingMiddleware` | Anthropic æ¨¡å‹ç¼“å­˜ä¼˜åŒ– |
| `PatchToolCallsMiddleware` | å·¥å…·è°ƒç”¨ä¿®å¤ |

### æ·»åŠ è‡ªå®šä¹‰ä¸­é—´ä»¶

```typescript
import { createMiddleware, createDeepAgent } from "deepagents";

let callCount = 0;

const loggingMiddleware = createMiddleware({
  name: "LoggingMiddleware",
  
  wrapToolCall: async (request, handler) => {
    callCount += 1;
    const toolName = request.toolCall.name;
    
    console.log(`[${new Date().toISOString()}] å·¥å…·è°ƒç”¨ #${callCount}: ${toolName}`);
    console.log(`  å‚æ•°: ${JSON.stringify(request.toolCall.args)}`);
    
    const startTime = Date.now();
    const result = await handler(request);
    const duration = Date.now() - startTime;
    
    console.log(`  è€—æ—¶: ${duration}ms`);
    console.log(`  ç»“æœ: ${JSON.stringify(result).slice(0, 100)}...`);
    
    return result;
  },
});

const agent = createDeepAgent({
  middleware: [loggingMiddleware],
});
```

### ä¸­é—´ä»¶æ‰§è¡Œæ—¶æœº

```
ç”¨æˆ·è¾“å…¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  beforeAgent()  â”‚  â† ä»£ç†å¼€å§‹å‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM è°ƒç”¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ wrapToolCall()  â”‚  â† æ¯æ¬¡å·¥å…·è°ƒç”¨å‰å
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  afterAgent()   â”‚  â† ä»£ç†å®Œæˆå
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æœ€ç»ˆå“åº”
```

## 5. subagents - ç»„å»º"åŠ©ç†å›¢é˜Ÿ"

å­ä»£ç†å…è®¸ä¸»ä»£ç†å°†ç‰¹å®šä»»åŠ¡å§”æ‰˜ç»™ä¸“é—¨çš„"åŠ©ç†"ã€‚

### åŸºç¡€ç”¨æ³•

```typescript
import { createDeepAgent } from "deepagents";

const researchAgent = {
  name: "researcher",
  description: "ä¸“é—¨è´Ÿè´£ä¿¡æ¯æœç´¢å’Œèµ„æ–™æ•´ç†",
  systemPrompt: "ä½ æ˜¯ä¸€åç ”ç©¶ä¸“å®¶ï¼Œæ“…é•¿ä»äº’è”ç½‘æ”¶é›†å’Œæ•´ç†ä¿¡æ¯ã€‚",
  tools: [internetSearchTool],
  model: "gpt-4o-mini",  // å¯ä»¥ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹
};

const writerAgent = {
  name: "writer",
  description: "ä¸“é—¨è´Ÿè´£æ’°å†™å’Œæ¶¦è‰²æ–‡ç« ",
  systemPrompt: "ä½ æ˜¯ä¸€åä¸“ä¸šä½œå®¶ï¼Œæ“…é•¿å°†ä¿¡æ¯æ•´ç†æˆæµç•…çš„æ–‡ç« ã€‚",
  tools: [],
  model: "claude-sonnet-4-5-20250929",  // å†™ä½œç”¨æ›´å¼ºçš„æ¨¡å‹
};

const mainAgent = createDeepAgent({
  subagents: [researchAgent, writerAgent],
  systemPrompt: `ä½ æ˜¯ä¸€ä¸ªé¡¹ç›®ç»ç†ã€‚
    - éœ€è¦æœç´¢ä¿¡æ¯æ—¶ï¼Œå§”æ‰˜ç»™ researcher
    - éœ€è¦æ’°å†™æ–‡ç« æ—¶ï¼Œå§”æ‰˜ç»™ writer
    - ä½ è´Ÿè´£åè°ƒæ•´ä½“æµç¨‹å’Œæœ€ç»ˆå®¡æ ¸`
});
```

### å­ä»£ç†é…ç½®é¡¹

| é…ç½®é¡¹ | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `name` | string | å­ä»£ç†åç§°ï¼ˆä¸»ä»£ç†é€šè¿‡æ­¤åç§°å§”æ‰˜ä»»åŠ¡ï¼‰ |
| `description` | string | æè¿°å­ä»£ç†çš„èƒ½åŠ›ï¼ˆå¸®åŠ©ä¸»ä»£ç†å†³å®šä½•æ—¶å§”æ‰˜ï¼‰ |
| `systemPrompt` | string | å­ä»£ç†çš„è§’è‰²å®šä¹‰ |
| `tools` | Tool[] | å­ä»£ç†å¯ç”¨çš„å·¥å…· |
| `model` | string | å­ä»£ç†ä½¿ç”¨çš„æ¨¡å‹ï¼ˆå¯é€‰ï¼Œé»˜è®¤ç»§æ‰¿ä¸»ä»£ç†ï¼‰ |
| `middleware` | Middleware[] | å­ä»£ç†çš„ä¸­é—´ä»¶ï¼ˆå¯é€‰ï¼‰ |
| `interruptOn` | object | å­ä»£ç†çš„äººæœºåä½œé…ç½®ï¼ˆå¯é€‰ï¼‰ |
| `skills` | string[] | å­ä»£ç†çš„æŠ€èƒ½ï¼ˆå¯é€‰ï¼‰ |

### å­ä»£ç† vs å·¥å…·

| ç‰¹æ€§ | å·¥å…· | å­ä»£ç† |
|------|------|--------|
| å¤æ‚åº¦ | å•ä¸€åŠŸèƒ½ | å¯ä»¥æœ‰è‡ªå·±çš„è§„åˆ’å’Œå·¥å…· |
| ä¸Šä¸‹æ–‡ | å…±äº«ä¸»ä»£ç†ä¸Šä¸‹æ–‡ | ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡ç©ºé—´ |
| é€‚ç”¨åœºæ™¯ | API è°ƒç”¨ã€è®¡ç®— | å¤æ‚å­ä»»åŠ¡ |
| è¿”å›å€¼ | ç›´æ¥è¿”å›ç»“æœ | è¿”å›æ‘˜è¦ |

## 6. backend - é…ç½®"æ¡£æ¡ˆç³»ç»Ÿ"

åç«¯å†³å®šäº†ä»£ç†çš„æ–‡ä»¶ç³»ç»Ÿå·¥å…·å¦‚ä½•å­˜å‚¨æ•°æ®ã€‚

### StateBackendï¼ˆé»˜è®¤ï¼‰

ä¸´æ—¶å­˜å‚¨ï¼Œæ•°æ®å­˜åœ¨ LangGraph çŠ¶æ€ä¸­ï¼š

```typescript
import { createDeepAgent } from "deepagents";
import { StateBackend } from "deepagents/backends";

const agent = createDeepAgent({
  backend: (rt) => new StateBackend(rt),
});
```

**ç‰¹ç‚¹**ï¼š
- âœ… æ— éœ€é¢å¤–é…ç½®
- âœ… é€‚åˆå•æ¬¡ä¼šè¯ä»»åŠ¡
- âŒ æ•°æ®ä¸è·¨ä¼šè¯æŒä¹…åŒ–

### FilesystemBackend

æœ¬åœ°ç£ç›˜è¯»å†™ï¼š

```typescript
import { FilesystemBackend } from "deepagents/backends";

const agent = createDeepAgent({
  backend: (rt) => new FilesystemBackend(rt, {
    workingDirectory: "/path/to/project",
  }),
});
```

**ç‰¹ç‚¹**ï¼š
- âœ… ç›´æ¥æ“ä½œæœ¬åœ°æ–‡ä»¶
- âœ… é€‚åˆå¼€å‘å’Œè°ƒè¯•
- âš ï¸ éœ€è¦è°¨æ…æˆæƒ

### StoreBackend

è·¨çº¿ç¨‹æŒä¹…åŒ–å­˜å‚¨ï¼š

```typescript
import { StoreBackend } from "deepagents/backends";
import { InMemoryStore } from "@langchain/langgraph";

const store = new InMemoryStore();

const agent = createDeepAgent({
  backend: (rt) => new StoreBackend(rt),
  store: store,
});
```

**ç‰¹ç‚¹**ï¼š
- âœ… æ•°æ®è·¨ä¼šè¯æŒä¹…åŒ–
- âœ… é€‚åˆé•¿æœŸè®°å¿†
- âœ… éƒ¨ç½²åˆ° LangSmith æ—¶è‡ªåŠ¨é…ç½®

### CompositeBackend

å¤šåç«¯è·¯ç”±â€”â€”ä¸åŒè·¯å¾„ä½¿ç”¨ä¸åŒå­˜å‚¨ï¼š

```typescript
import { CompositeBackend, StateBackend, StoreBackend } from "deepagents/backends";
import { InMemoryStore } from "@langchain/langgraph";

const store = new InMemoryStore();

const agent = createDeepAgent({
  backend: (rt) => new CompositeBackend(
    new StateBackend(rt),  // é»˜è®¤åç«¯
    {
      "/memories/": new StoreBackend(rt),   // è®°å¿†è·¯å¾„ â†’ æŒä¹…åŒ–
      "/workspace/": new FilesystemBackend(rt, { workingDirectory: "." }),
    }
  ),
  store: store,
});
```

**è·¯ç”±è§„åˆ™**ï¼š
- å†™å…¥ `/memories/notes.md` â†’ ä½¿ç”¨ StoreBackendï¼ˆæŒä¹…åŒ–ï¼‰
- å†™å…¥ `/workspace/code.ts` â†’ ä½¿ç”¨ FilesystemBackendï¼ˆæœ¬åœ°ï¼‰
- å†™å…¥ `/temp/data.json` â†’ ä½¿ç”¨ StateBackendï¼ˆä¸´æ—¶ï¼‰

## 7. interruptOn - è®¾ç½®"å®¡æ‰¹æµç¨‹"

æŸäº›æ•æ„Ÿæ“ä½œéœ€è¦äººç±»ç¡®è®¤æ‰èƒ½æ‰§è¡Œã€‚

### åŸºç¡€ç”¨æ³•

```typescript
import { createDeepAgent } from "deepagents";
import { MemorySaver } from "@langchain/langgraph";

const checkpointer = new MemorySaver();

const agent = createDeepAgent({
  tools: [deleteFileTool, sendEmailTool, readFileTool],
  interruptOn: {
    delete_file: true,  // åˆ é™¤æ–‡ä»¶éœ€è¦å®¡æ‰¹
    send_email: { allowedDecisions: ["approve", "reject"] },  // å‘é‚®ä»¶éœ€è¦å®¡æ‰¹ï¼Œä½†ä¸å…è®¸ç¼–è¾‘
    read_file: false,   // è¯»æ–‡ä»¶ä¸éœ€è¦å®¡æ‰¹
  },
  checkpointer,  // å¿…é¡»æä¾›ï¼
});
```

### å†³ç­–ç±»å‹

| å†³ç­– | è¯´æ˜ |
|------|------|
| `approve` | æ‰¹å‡†æ‰§è¡Œ |
| `edit` | ä¿®æ”¹å‚æ•°åæ‰¹å‡† |
| `reject` | æ‹’ç»æ‰§è¡Œ |

### å¤„ç†ä¸­æ–­

```typescript
const result = await agent.invoke({
  messages: [{ role: "user", content: "åˆ é™¤ temp.txt" }],
}, { configurable: { thread_id: "thread-1" } });

if (result.interrupted) {
  console.log("éœ€è¦å®¡æ‰¹:", result.pendingToolCalls);
  
  // ç”¨æˆ·æ‰¹å‡†åç»§ç»­
  const continued = await agent.invoke(
    { decision: "approve" },
    { configurable: { thread_id: "thread-1" } }
  );
}
```

## 8. skills - åŠ è½½"ä¸“ä¸šæŠ€èƒ½"

æŠ€èƒ½æ˜¯å¯æŒ‰éœ€åŠ è½½çš„ä¸“ä¸šèƒ½åŠ›æ¨¡å—ã€‚

### æŠ€èƒ½æ–‡ä»¶æ ¼å¼ï¼ˆSKILL.mdï¼‰

```markdown
---
name: react-component-generator
description: ç”Ÿæˆ React ç»„ä»¶çš„æŠ€èƒ½
compatibility:
  - React
  - TypeScript
allowed-tools:
  - write_file
  - read_file
---

# React ç»„ä»¶ç”ŸæˆæŠ€èƒ½

## ä½¿ç”¨æ–¹æ³•

å½“ç”¨æˆ·è¦æ±‚åˆ›å»º React ç»„ä»¶æ—¶ï¼Œéµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. ç¡®è®¤ç»„ä»¶ç±»å‹ï¼ˆå‡½æ•°ç»„ä»¶/ç±»ç»„ä»¶ï¼‰
2. ç¡®è®¤æ˜¯å¦éœ€è¦ TypeScript
3. ç”Ÿæˆç»„ä»¶ä»£ç 

## ä»£ç æ¨¡æ¿

### å‡½æ•°ç»„ä»¶æ¨¡æ¿

```tsx
interface ${ComponentName}Props {
  // props
}

export const ${ComponentName}: React.FC<${ComponentName}Props> = (props) => {
  return (
    <div>
      {/* content */}
    </div>
  );
};
```
```

### åŠ è½½æŠ€èƒ½

```typescript
import { createDeepAgent } from "deepagents";
import { MemorySaver } from "@langchain/langgraph";

const checkpointer = new MemorySaver();

const agent = createDeepAgent({
  skills: ["/skills/"],  // æŠ€èƒ½ç›®å½•è·¯å¾„
  checkpointer,
});

// è°ƒç”¨æ—¶ä¼ å…¥æŠ€èƒ½æ–‡ä»¶
const result = await agent.invoke({
  messages: [{ role: "user", content: "åˆ›å»ºä¸€ä¸ª Button ç»„ä»¶" }],
  files: {
    "/skills/react-generator/SKILL.md": skillFileData,
  },
}, { configurable: { thread_id: "thread-1" } });
```

### æŠ€èƒ½ vs è®°å¿†

| ç‰¹æ€§ | æŠ€èƒ½ (Skills) | è®°å¿† (Memory) |
|------|--------------|---------------|
| å†…å®¹ç±»å‹ | å…¬å…±çŸ¥è¯†ã€æ¨¡æ¿ã€æŒ‡å— | ç”¨æˆ·åå¥½ã€å†å²ç»éªŒ |
| æ¥æº | å¼€å‘è€…é¢„å®šä¹‰ | ä»£ç†åœ¨ä½¿ç”¨ä¸­å­¦ä¹  |
| åŠ è½½æ—¶æœº | æŒ‰éœ€åŠ è½½ï¼ˆæ¸è¿›å¼æŠ«éœ²ï¼‰ | æ¯æ¬¡å¯¹è¯å¼€å§‹æ—¶åŠ è½½ |
| å¯ä¿®æ”¹æ€§ | é€šå¸¸åªè¯» | å¯è¯»å†™ |

## 9. responseFormat - ç»“æ„åŒ–è¾“å‡º

è®©ä»£ç†è¿”å›ç¬¦åˆç‰¹å®šç»“æ„çš„æ•°æ®ã€‚

```typescript
import { createDeepAgent } from "deepagents";
import { z } from "zod";

const weatherReportSchema = z.object({
  location: z.string().describe("åœ°ç‚¹"),
  temperature: z.number().describe("æ¸©åº¦ï¼ˆæ‘„æ°åº¦ï¼‰"),
  condition: z.string().describe("å¤©æ°”çŠ¶å†µ"),
  humidity: z.number().describe("æ¹¿åº¦ç™¾åˆ†æ¯”"),
  forecast: z.string().describe("æœªæ¥ 24 å°æ—¶é¢„æŠ¥"),
});

const agent = createDeepAgent({
  tools: [weatherTool],
  responseFormat: weatherReportSchema,
});

const result = await agent.invoke({
  messages: [{ role: "user", content: "æŸ¥è¯¢åŒ—äº¬å¤©æ°”" }],
});

console.log(result.structuredResponse);
// {
//   location: "åŒ—äº¬",
//   temperature: 25,
//   condition: "æ™´",
//   humidity: 45,
//   forecast: "æ˜å¤©å¤šäº‘ï¼Œæ°”æ¸©ç•¥é™"
// }
```

## å®Œæ•´é…ç½®ç¤ºä¾‹

```typescript
import { createDeepAgent } from "deepagents";
import { CompositeBackend, StateBackend, StoreBackend } from "deepagents/backends";
import { MemorySaver, InMemoryStore } from "@langchain/langgraph";

const checkpointer = new MemorySaver();
const store = new InMemoryStore();

const researchSubAgent = {
  name: "researcher",
  description: "è´Ÿè´£ä¿¡æ¯æœç´¢",
  systemPrompt: "ä½ æ˜¯ç ”ç©¶ä¸“å®¶",
  tools: [searchTool],
};

const agent = createDeepAgent({
  name: "ProjectManager",
  model: "claude-sonnet-4-5-20250929",
  tools: [calculatorTool, translatorTool],
  systemPrompt: `ä½ æ˜¯ä¸€ä¸ªé¡¹ç›®ç»ç†ï¼Œè´Ÿè´£åè°ƒç ”ç©¶å’ŒæŠ¥å‘Šæ’°å†™å·¥ä½œã€‚`,
  middleware: [loggingMiddleware],
  subagents: [researchSubAgent],
  backend: (rt) => new CompositeBackend(
    new StateBackend(rt),
    { "/memories/": new StoreBackend(rt) }
  ),
  interruptOn: {
    send_email: true,
  },
  skills: ["/skills/"],
  memory: ["/AGENTS.md"],
  store,
  checkpointer,
});
```

## å°ç»“

æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† `createDeepAgent()` çš„ä¹å¤§é…ç½®é¡¹ï¼š

| é…ç½®é¡¹ | ç”¨é€” | ç±»æ¯” |
|--------|------|------|
| model | é€‰æ‹© LLM | å¤§è„‘ |
| tools | æ·»åŠ èƒ½åŠ› | åŒæ‰‹ |
| systemPrompt | å®šä¹‰è§’è‰² | èŒä¸šåŸ¹è®­ |
| middleware | æ‰©å±•åŠŸèƒ½ | èƒ½åŠ›å¢å¼º |
| subagents | ä»»åŠ¡å§”æ‰˜ | åŠ©ç†å›¢é˜Ÿ |
| backend | æ•°æ®å­˜å‚¨ | æ¡£æ¡ˆç³»ç»Ÿ |
| interruptOn | äººæœºåä½œ | å®¡æ‰¹æµç¨‹ |
| skills | ä¸“ä¸šçŸ¥è¯† | æŠ€èƒ½è¯ä¹¦ |
| memory | ç»éªŒè®°å¿† | ä¸ªäººæ—¥è®° |

æŒæ¡è¿™äº›é…ç½®ï¼Œä½ å°±èƒ½æ‰“é€ å‡ºé€‚åº”å„ç§åœºæ™¯çš„ä¸“å±ä»£ç†ã€‚

## ä¸‹ä¸€æ­¥

åœ¨åç»­æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢ç´¢ï¼š
- åç«¯ç³»ç»Ÿçš„è¯¦ç»†é…ç½®
- å­ä»£ç†çš„é«˜çº§ç”¨æ³•
- äººæœºåä½œçš„å®Œæ•´æµç¨‹
- æŠ€èƒ½ç³»ç»Ÿçš„å¼€å‘æŒ‡å—

## å®è·µä»»åŠ¡

1. åˆ›å»ºä¸€ä¸ªä½¿ç”¨ GPT-4 çš„ä»£ç†ï¼Œå¯¹æ¯”å®ƒä¸é»˜è®¤ Claude çš„è¡¨ç°
2. ä¸ºä»£ç†æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„"ç¿»è¯‘"å·¥å…·
3. é…ç½® CompositeBackendï¼Œå®ç°ä¸´æ—¶æ–‡ä»¶å’ŒæŒä¹…è®°å¿†çš„åˆ†ç¦»
4. å°è¯•è®¾ç½® interruptOnï¼Œä½“éªŒäººæœºåä½œæµç¨‹

## å‚è€ƒèµ„æº

- [DeepAgents è‡ªå®šä¹‰æ–‡æ¡£](https://docs.langchain.com/oss/javascript/deepagents/customization)
- [LangChain æ¨¡å‹é›†æˆ](https://docs.langchain.com/oss/javascript/integrations/chat)
- [LangGraph ä¸­é—´ä»¶](https://docs.langchain.com/oss/javascript/langchain/middleware)
