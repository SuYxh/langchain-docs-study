# LangGraph æ€ç»´æ¨¡å¼ï¼š5 æ­¥æ„å»º AI Agent æ–¹æ³•è®º

## ç®€å•æ¥è¯´

LangGraph å°±æ˜¯æ•™ä½ å¦‚ä½•æŠŠä¸€ä¸ªå¤æ‚çš„ AI ä»»åŠ¡æ‹†æˆ"æµæ°´çº¿å·¥åº"ï¼Œæ¯ä¸ªå·¥åºå¹²ä¸€ä»¶äº‹ã€å…±äº«ä¸€å—"å…¬å‘Šæ¿"æ¥ä¼ é€’ä¿¡æ¯ï¼Œç„¶åæŒ‰è§„åˆ™å†³å®šä¸‹ä¸€æ­¥å¹²å•¥ã€‚æœ¬è´¨ä¸Šæ˜¯è®©ä½ çš„ AI Agent ä»"ä¸€å›¢ä¹±éº»"å˜æˆ"äº•äº•æœ‰æ¡çš„æµç¨‹å›¾"ã€‚

---

## ğŸ¯ æœ¬èŠ‚ç›®æ ‡

å­¦å®Œæœ¬èŠ‚ï¼Œä½ å°†èƒ½å¤Ÿï¼š

- æŒæ¡ LangGraph çš„ **5 æ­¥æ„å»ºæ–¹æ³•è®º**
- ç†è§£ Nodeã€Stateã€Edgeã€Command çš„è®¾è®¡åŸåˆ™
- å­¦ä¼š **4 ç§é”™è¯¯å¤„ç†ç­–ç•¥**
- èƒ½å¤Ÿç‹¬ç«‹è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„ Agent æ¶æ„

---

## æ ¸å¿ƒç—›ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### ç—›ç‚¹ï¼šAI åšå¤æ‚ä»»åŠ¡æ—¶åƒæ²¡å¤´è‹è‡

æƒ³è±¡ä¸€ä¸‹ï¼šä½ è®©ä¸€ä¸ª AI å¤„ç†å®¢æœé‚®ä»¶ï¼Œå®ƒè¦åŒæ—¶è€ƒè™‘ï¼š
- è¿™å°é‚®ä»¶åœ¨è¯´ä»€ä¹ˆï¼Ÿ
- ç´§æ€¥ç¨‹åº¦å¦‚ä½•ï¼Ÿ
- è¦ä¸è¦æŸ¥æ–‡æ¡£ï¼Ÿ
- è¦ä¸è¦åˆ›å»º Bug å·¥å•ï¼Ÿ
- éœ€ä¸éœ€è¦äººå·¥ä»‹å…¥ï¼Ÿ
- æœ€åæ€ä¹ˆå›å¤ï¼Ÿ

å¦‚æœä¸åšä»»ä½•æ¶æ„è®¾è®¡ï¼Œä½ çš„ä»£ç å¯èƒ½ä¼šå˜æˆè¿™æ ·ï¼š

```typescript
if (è¿™ä¸ª) {
  then é‚£ä¸ª
} else if (å¦ä¸€ä¸ª) {
  then åˆä¸€ä¸ª
} else if (...) {
  // æ— é™åµŒå¥—...
}
```

å…¸å‹çš„"é¢æ¡ä»£ç "ï¼Œè°ƒè¯•å™©æ¢¦ã€‚

| ç—›ç‚¹ | å…·ä½“è¡¨ç° |
|------|----------|
| **é€»è¾‘æ··ä¹±** | ä¸€ä¸ªå·¨å¤§çš„ if-else å‡½æ•°ï¼Œæ”¹ä¸€å¤„åŠ¨å…¨èº« |
| **çŠ¶æ€ä¹±é£** | ä¸­é—´æ•°æ®åˆ°å¤„ä¼ ï¼Œä¸çŸ¥é“è°ç”¨äº†ä»€ä¹ˆ |
| **æ— æ³•æ¢å¤** | å‡ºé”™äº†åªèƒ½ä»å¤´å†æ¥ï¼Œæµªè´¹ç®—åŠ› |
| **è°ƒè¯•å›°éš¾** | æ‰“æ–­ç‚¹æ‰“åˆ°æ€€ç–‘äººç”Ÿ |

### è§£å†³ï¼šLangGraph çš„åˆ†è€Œæ²»ä¹‹

| ç—›ç‚¹ | LangGraph çš„è§£æ³• |
|------|------------------|
| é€»è¾‘æ··ä¹± | æŠŠæµç¨‹æ‹†æˆç‹¬ç«‹çš„ **Nodeï¼ˆèŠ‚ç‚¹ï¼‰**ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªå¹²ä¸€ä»¶äº‹ |
| çŠ¶æ€ä¹±é£ | ç”¨ç»Ÿä¸€çš„ **Stateï¼ˆçŠ¶æ€ï¼‰** ä½œä¸º"å…¬å‘Šæ¿"ï¼Œæ‰€æœ‰æ•°æ®éƒ½è´´åœ¨è¿™ |
| æ— æ³•æ¢å¤ | ç”¨ **Checkpointerï¼ˆæ£€æŸ¥ç‚¹ï¼‰** ä¿å­˜è¿›åº¦ï¼Œå¤±è´¥å¯ä»æ–­ç‚¹æ¢å¤ |
| è°ƒè¯•å›°éš¾ | æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥è¾“å‡ºæ¸…æ¸…æ¥šæ¥šï¼Œé…åˆ LangSmith å¯è§†åŒ– |

---

## ç”Ÿæ´»åŒ–ç±»æ¯”ï¼šä¸“ä¸šå®¢æœä¸­å¿ƒ

æƒ³è±¡ä½ å¼€äº†ä¸€å®¶å®¢æœä¸­å¿ƒï¼Œæ¯å¤©æ”¶åˆ°æµ·é‡å®¢æˆ·é‚®ä»¶ã€‚ä½ ä¸å¯èƒ½è®©ä¸€ä¸ªäººä»å¤´åˆ°å°¾å¤„ç†æ‰€æœ‰äº‹æƒ…ï¼Œæ‰€ä»¥ä½ è®¾è®¡äº†ä¸€å¥—æµæ°´çº¿ï¼š

```
                        [ åˆ†æ‹£å‘˜å°ç‹ ]
                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚                    â”‚
  [ æŸ¥æ–‡æ¡£çš„å°æ ]      [ è®° Bug çš„å°å¼  ]      [ ä¸»ç®¡è€é™ˆ ]
         â”‚                    â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                        [ å†™å›å¤çš„å°ç¾ ]
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
       [ ä¸»ç®¡è€é™ˆå®¡æ‰¹ ]                  [ ç›´æ¥å‘é€ ]
```

**LangGraph æ¦‚å¿µå¯¹ç…§è¡¨ï¼š**

| LangGraph æ¦‚å¿µ | å®¢æœä¸­å¿ƒç±»æ¯” | å…·ä½“ä½œç”¨ |
|---------------|-------------|---------|
| **Nodeï¼ˆèŠ‚ç‚¹ï¼‰** | æ¯ä¸ªå·¥ä½ä¸Šçš„å‘˜å·¥ | å°ç‹è´Ÿè´£åˆ†ç±»ã€å°æè´Ÿè´£æŸ¥æ–‡æ¡£ã€å°ç¾è´Ÿè´£å†™å›å¤ |
| **Stateï¼ˆçŠ¶æ€ï¼‰** | æµè½¬çš„å·¥å•å¤¹ | é‡Œé¢å¤¹ç€å®¢æˆ·é‚®ä»¶åŸæ–‡ã€åˆ†ç±»ç»“æœã€æŸ¥åˆ°çš„èµ„æ–™ã€è‰ç¨¿å›å¤ |
| **Edgeï¼ˆè¾¹ï¼‰** | å·¥å•ä¼ é€’è·¯çº¿ | å°ç‹åˆ†ç±»å®Œç»™å°æ/å°å¼ /è€é™ˆ |
| **Commandï¼ˆå‘½ä»¤ï¼‰** | å·¥å•ä¸Šçš„æ‰¹æ³¨ | "åˆ†ç±»å®Œæ¯•ï¼Œè¿™æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè½¬ç»™å°ææŸ¥æ–‡æ¡£" |
| **interrupt()** | ç­‰å¾…ä¸»ç®¡ç­¾å­— | ä¸»ç®¡ä¸åœ¨ï¼Ÿå…ˆæŠŠå·¥å•æ”¾ç€ï¼Œç­‰ä¸»ç®¡å›æ¥ç»§ç»­ |
| **Checkpointer** | æ¯ä¸ªå·¥ä½çš„å­˜æ¡£æŸœ | ä¸‡ä¸€åœç”µäº†ï¼Œæ¢å¤åä»æœ€è¿‘å®Œæˆçš„å·¥ä½ç»§ç»­ |

---

## 5 æ­¥æ„å»ºæ–¹æ³•è®º

### Step 1ï¼šç”»å‡ºå·¥ä½œæµç¨‹å›¾

é¦–å…ˆï¼ŒæŠŠä½ è¦è‡ªåŠ¨åŒ–çš„æµç¨‹**å¯è§†åŒ–**å‡ºæ¥ã€‚

**ç¤ºä¾‹éœ€æ±‚**ï¼šæ„å»ºä¸€ä¸ªå®¢æœé‚®ä»¶å¤„ç† Agent

```
ç”¨æˆ·éœ€æ±‚ï¼š
1. è¯»å–å®¢æˆ·é‚®ä»¶
2. åˆ†ç±»ï¼ˆç´§æ€¥ç¨‹åº¦ã€é—®é¢˜ç±»å‹ï¼‰
3. ç®€å•é—®é¢˜ â†’ æŸ¥æ–‡æ¡£
4. Bug æŠ¥å‘Š â†’ åˆ›å»ºå·¥å•
5. ç´§æ€¥/å¤æ‚é—®é¢˜ â†’ äººå·¥ä»‹å…¥
6. èµ·è‰å›å¤
7. é«˜ä¼˜å…ˆçº§éœ€å®¡æ ¸åå‘é€
```

**ç”»æˆæµç¨‹å›¾ï¼š**

```
     START
        â”‚
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è¯»å–é‚®ä»¶  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ åˆ†ç±»æ„å›¾  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚    â”‚    â”‚            â”‚
   â–¼    â–¼    â–¼            â–¼
 æŸ¥æ–‡æ¡£  Bug  äººå·¥å®¡æ ¸   ç›´æ¥èµ·è‰
   â”‚   å·¥å•    â”‚           â”‚
   â”‚    â”‚      â”‚           â”‚
   â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ èµ·è‰å›å¤  â”‚
              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
            â”‚             â”‚
            â–¼             â–¼
       äººå·¥å®¡æ ¸       ç›´æ¥å‘é€
            â”‚             â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
                  END
```

ğŸ’¡ **å…³é”®æ´å¯Ÿ**ï¼š
- æœ‰äº›èŠ‚ç‚¹åš**å†³ç­–**ï¼ˆåˆ†ç±»æ„å›¾ã€èµ·è‰å›å¤å†³å®šæ˜¯å¦éœ€è¦å®¡æ ¸ï¼‰
- æœ‰äº›èŠ‚ç‚¹åš**æ‰§è¡Œ**ï¼ˆæŸ¥æ–‡æ¡£ã€å‘é€é‚®ä»¶ï¼‰
- å…ˆç”»å›¾ï¼Œå†å†™ä»£ç 

### Step 2ï¼šè¯†åˆ«æ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹

ä¸åŒç±»å‹çš„èŠ‚ç‚¹éœ€è¦ä¸åŒçš„å¤„ç†æ–¹å¼ï¼š

| èŠ‚ç‚¹ç±»å‹ | ç‰¹ç‚¹ | ç¤ºä¾‹ |
|---------|------|------|
| **LLM æ­¥éª¤** | éœ€è¦ç†è§£ã€åˆ†æã€ç”Ÿæˆæ–‡æœ¬ | åˆ†ç±»æ„å›¾ã€èµ·è‰å›å¤ |
| **æ•°æ®æ­¥éª¤** | ä»å¤–éƒ¨è·å–ä¿¡æ¯ | æŸ¥æ–‡æ¡£ã€æŸ¥å®¢æˆ·å†å² |
| **åŠ¨ä½œæ­¥éª¤** | æ‰§è¡Œå¤–éƒ¨æ“ä½œ | å‘é€é‚®ä»¶ã€åˆ›å»ºå·¥å• |
| **äººå·¥æ­¥éª¤** | éœ€è¦äººç±»ä»‹å…¥ | å®¡æ ¸é«˜ä¼˜å…ˆçº§å›å¤ |

**ä¸ºæ¯ä¸ªèŠ‚ç‚¹å®šä¹‰ï¼š**

```typescript
// LLM æ­¥éª¤
classifyIntent: {
  é™æ€ä¸Šä¸‹æ–‡: "åˆ†ç±»æ ‡å‡†ã€ç´§æ€¥ç¨‹åº¦å®šä¹‰",
  åŠ¨æ€ä¸Šä¸‹æ–‡: "é‚®ä»¶å†…å®¹ã€å‘ä»¶äººä¿¡æ¯",
  æœŸæœ›è¾“å‡º: "ç»“æ„åŒ–çš„åˆ†ç±»ç»“æœ"
}

// æ•°æ®æ­¥éª¤
searchDocumentation: {
  å‚æ•°: "ä»æ„å›¾å’Œä¸»é¢˜æ„å»ºæŸ¥è¯¢",
  é‡è¯•ç­–ç•¥: "æ˜¯ï¼ŒæŒ‡æ•°é€€é¿",
  ç¼“å­˜: "å¸¸è§æŸ¥è¯¢å¯ç¼“å­˜"
}

// åŠ¨ä½œæ­¥éª¤
sendReply: {
  æ‰§è¡Œæ—¶æœº: "å®¡æ ¸é€šè¿‡å",
  é‡è¯•ç­–ç•¥: "æ˜¯ï¼Œç½‘ç»œé—®é¢˜é‡è¯•",
  ä¸å¯ç¼“å­˜: "æ¯æ¬¡å‘é€éƒ½æ˜¯å”¯ä¸€æ“ä½œ"
}

// äººå·¥æ­¥éª¤
humanReview: {
  ä¸Šä¸‹æ–‡: "åŸé‚®ä»¶ã€è‰ç¨¿å›å¤ã€ç´§æ€¥ç¨‹åº¦",
  æœŸæœ›è¾“å…¥: "é€šè¿‡/æ‹’ç» + å¯é€‰çš„ä¿®æ”¹å†…å®¹",
  è§¦å‘æ¡ä»¶: "é«˜ä¼˜å…ˆçº§ã€å¤æ‚é—®é¢˜"
}
```

### Step 3ï¼šè®¾è®¡ Stateï¼ˆçŠ¶æ€ï¼‰

State æ˜¯æ‰€æœ‰èŠ‚ç‚¹å…±äº«çš„"å…¬å‘Šæ¿"ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒã€‚

**è®¾è®¡åŸåˆ™ï¼šåªå­˜åŸå§‹æ•°æ®ï¼Œä¸å­˜æ ¼å¼åŒ–æ–‡æœ¬**

```typescript
import { StateSchema } from "@langchain/langgraph";
import * as z from "zod";

const EmailClassificationSchema = z.object({
  intent: z.enum(["question", "bug", "billing", "feature", "complex"]),
  urgency: z.enum(["low", "medium", "high", "critical"]),
  topic: z.string(),
  summary: z.string(),
});

const EmailAgentState = new StateSchema({
  emailContent: z.string(),
  senderEmail: z.string(),
  emailId: z.string(),
  
  classification: EmailClassificationSchema.optional(),
  
  searchResults: z.array(z.string()).optional(),
  customerHistory: z.record(z.string(), z.any()).optional(),
  
  responseText: z.string().optional(),
});
```

ğŸ’¡ **äººè¯è§£è¯»ï¼š**
> "æˆ‘å®šä¹‰äº†ä¸€ä¸ªå·¥å•å¤¹ï¼Œé‡Œé¢å¯ä»¥æ”¾ï¼šé‚®ä»¶åŸæ–‡ã€å‘ä»¶äººã€åˆ†ç±»ç»“æœã€æŸ¥åˆ°çš„èµ„æ–™ã€è‰ç¨¿å›å¤ã€‚æœ‰äº›æ ¼å­ä¸€å¼€å§‹æ˜¯ç©ºçš„ï¼ˆoptionalï¼‰ï¼Œåé¢çš„å·¥ä½ä¼šå¡«ä¸Šã€‚"

**ä¸ºä»€ä¹ˆåªå­˜åŸå§‹æ•°æ®ï¼Ÿ**

| å­˜åŸå§‹æ•°æ® | å­˜æ ¼å¼åŒ–æ–‡æœ¬ |
|-----------|-------------|
| ä¸åŒèŠ‚ç‚¹å¯ä»¥ç”¨ä¸åŒæ–¹å¼å±•ç¤º | æ ¼å¼å›ºå®šï¼Œéš¾ä»¥å¤ç”¨ |
| æ”¹æç¤ºè¯ä¸ç”¨æ”¹çŠ¶æ€ç»“æ„ | æ”¹æ ¼å¼è¦æ”¹çŠ¶æ€å®šä¹‰ |
| è°ƒè¯•æ—¶çœ‹åˆ°çœŸå®æ•°æ® | è°ƒè¯•æ—¶çœ‹åˆ°åŠ å·¥åçš„å†…å®¹ |

### Step 4ï¼šæ„å»ºèŠ‚ç‚¹å‡½æ•°

èŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼š**è¯»å–çŠ¶æ€ â†’ å¹²æ´» â†’ è¿”å›æ›´æ–°**

**åˆ†ç±»èŠ‚ç‚¹ç¤ºä¾‹ï¼š**

```typescript
import { Command, GraphNode } from "@langchain/langgraph";
import { ChatAnthropic } from "@langchain/anthropic";

const llm = new ChatAnthropic({ model: "claude-sonnet-4-5-20250929" });

const classifyIntent: GraphNode<typeof EmailAgentState> = async (state) => {
  const structuredLlm = llm.withStructuredOutput(EmailClassificationSchema);
  
  const classificationPrompt = `
    åˆ†æè¿™å°å®¢æˆ·é‚®ä»¶å¹¶åˆ†ç±»ï¼š
    
    é‚®ä»¶å†…å®¹: ${state.emailContent}
    å‘ä»¶äºº: ${state.senderEmail}
    
    è¯·æä¾›æ„å›¾ã€ç´§æ€¥ç¨‹åº¦ã€ä¸»é¢˜å’Œæ‘˜è¦ã€‚
  `;
  
  const classification = await structuredLlm.invoke(classificationPrompt);
  
  let nextNode: string;
  if (classification.intent === "billing" || classification.urgency === "critical") {
    nextNode = "humanReview";
  } else if (classification.intent === "question" || classification.intent === "feature") {
    nextNode = "searchDocumentation";
  } else if (classification.intent === "bug") {
    nextNode = "bugTracking";
  } else {
    nextNode = "draftResponse";
  }
  
  return new Command({
    update: { classification },
    goto: nextNode,
  });
};
```

ğŸ’¡ **äººè¯è§£è¯»ï¼š**
> "åˆ†æ‹£å‘˜å°ç‹çš„å·¥ä½œï¼šç”¨ AI åˆ¤æ–­è¿™å°é‚®ä»¶æ˜¯ä»€ä¹ˆç±»å‹ã€ç´§ä¸ç´§æ€¥ã€‚ç„¶åæ ¹æ®æƒ…å†µæ´¾å•ï¼š
> - ç´§æ€¥è´¦å•é—®é¢˜ï¼Ÿç›´æ¥æ‰¾ä¸»ç®¡ï¼
> - æ™®é€šé—®é¢˜ï¼Ÿå…ˆå»æŸ¥æŸ¥èµ„æ–™
> - è¯´æ˜¯ Bugï¼Ÿå»ºä¸ªå·¥å•è¿½è¸ª
> - å…¶ä»–æƒ…å†µï¼Ÿç›´æ¥å†™å›å¤"

**äººå·¥å®¡æ ¸èŠ‚ç‚¹ç¤ºä¾‹ï¼š**

```typescript
import { interrupt } from "@langchain/langgraph";

const humanReview: GraphNode<typeof EmailAgentState> = async (state) => {
  const humanDecision = interrupt({
    originalEmail: state.emailContent,
    draftResponse: state.responseText,
    urgency: state.classification?.urgency,
    action: "è¯·å®¡æ ¸è¿™å°å›å¤",
  });
  
  if (humanDecision.approved) {
    return new Command({
      update: { responseText: humanDecision.editedResponse || state.responseText },
      goto: "sendReply",
    });
  } else {
    return new Command({ update: {}, goto: END });
  }
};
```

ğŸ’¡ **äººè¯è§£è¯»ï¼š**
> "åˆ°äº†ä¸»ç®¡è€é™ˆè¿™é‡Œï¼š
> 1. å…ˆæŠŠå·¥å•æ”¾ä»–æ¡Œä¸Šï¼ˆinterruptï¼‰ï¼Œç„¶åæ•´ä¸ªæµæ°´çº¿æš‚åœ
> 2. è€é™ˆå•¥æ—¶å€™å›æ¥ã€çœ‹å®Œã€ç­¾å­—ï¼Œæµæ°´çº¿æ‰ç»§ç»­
> 3. ç­¾å­—åŒæ„ï¼Ÿå¾€ä¸‹é€å»å‘é€
> 4. ä¸åŒæ„ï¼Ÿè¿™å•ç»“æŸï¼Œä»–è‡ªå·±å¤„ç†"

### Step 5ï¼šè¿æ¥èŠ‚ç‚¹æˆå›¾

æœ€åä¸€æ­¥ï¼šæŠŠæ‰€æœ‰èŠ‚ç‚¹è¿èµ·æ¥ã€‚

```typescript
import { StateGraph, START, END, MemorySaver } from "@langchain/langgraph";

const workflow = new StateGraph(EmailAgentState)
  .addNode("readEmail", readEmail)
  .addNode("classifyIntent", classifyIntent)
  .addNode("searchDocumentation", searchDocumentation, { 
    retryPolicy: { maxAttempts: 3 } 
  })
  .addNode("bugTracking", bugTracking)
  .addNode("draftResponse", draftResponse)
  .addNode("humanReview", humanReview)
  .addNode("sendReply", sendReply)
  
  .addEdge(START, "readEmail")
  .addEdge("readEmail", "classifyIntent")
  .addEdge("sendReply", END);

const memory = new MemorySaver();
const app = workflow.compile({ checkpointer: memory });
```

ğŸ’¡ **äººè¯è§£è¯»ï¼š**
> "æŠŠæ‰€æœ‰å·¥ä½è¿èµ·æ¥ï¼š
> - èµ·ç‚¹ â†’ è¯»é‚®ä»¶ â†’ åˆ†ç±»ï¼ˆåˆ†ç±»åå„è‡ªå†³å®šå»å“ªï¼‰
> - å‘é€å®Œæ¯• â†’ ç»ˆç‚¹
> - æŸ¥æ–‡æ¡£å·¥ä½å¦‚æœç½‘ç»œæŠ–åŠ¨ï¼Œè‡ªåŠ¨é‡è¯• 3 æ¬¡
> - æ•´æ¡çº¿å¼€å¯è‡ªåŠ¨å­˜æ¡£åŠŸèƒ½"

**æ³¨æ„**ï¼šå›¾ç»“æ„å¾ˆç®€æ´ï¼Œå› ä¸ºè·¯ç”±é€»è¾‘åœ¨èŠ‚ç‚¹å†…éƒ¨é€šè¿‡ `Command` å¤„ç†ã€‚

---

## é”™è¯¯å¤„ç†å››è±¡é™

ä¸åŒçš„é”™è¯¯éœ€è¦ä¸åŒçš„å¤„ç†ç­–ç•¥ï¼š

| é”™è¯¯ç±»å‹ | è°æ¥ä¿® | ç­–ç•¥ | ä»£ç ç¤ºä¾‹ |
|---------|--------|------|---------|
| **çŸ­æš‚é”™è¯¯** | ç³»ç»Ÿè‡ªåŠ¨ | é‡è¯•ç­–ç•¥ | ç½‘ç»œæŠ–åŠ¨ã€API é™æµ |
| **LLM å¯æ¢å¤** | AI è‡ªå·± | å­˜é”™è¯¯åˆ° Stateï¼Œè®© AI é‡è¯• | å·¥å…·è°ƒç”¨å¤±è´¥ |
| **éœ€è¦ç”¨æˆ·** | äººç±» | interrupt() æš‚åœ | ç¼ºå°‘è´¦æˆ· ID |
| **æ„å¤–é”™è¯¯** | å¼€å‘è€… | ç›´æ¥æŠ›å‡º | æœªçŸ¥ Bug |

### 1. çŸ­æš‚é”™è¯¯ï¼šè‡ªåŠ¨é‡è¯•

```typescript
workflow.addNode(
  "searchDocumentation",
  searchDocumentation,
  { retryPolicy: { maxAttempts: 3, initialInterval: 1.0 } }
);
```

### 2. LLM å¯æ¢å¤ï¼šå­˜é”™è¯¯è®© AI çœ‹åˆ°

```typescript
const executeTool: GraphNode<typeof State> = async (state) => {
  try {
    const result = await runTool(state.toolCall);
    return new Command({
      update: { toolResult: result },
      goto: "agent",
    });
  } catch (error) {
    return new Command({
      update: { toolResult: `å·¥å…·é”™è¯¯: ${error}` },
      goto: "agent"
    });
  }
};
```

### 3. éœ€è¦ç”¨æˆ·ï¼šæš‚åœç­‰å¾…

```typescript
const lookupCustomer: GraphNode<typeof State> = async (state) => {
  if (!state.customerId) {
    const userInput = interrupt({
      message: "éœ€è¦å®¢æˆ· ID",
      request: "è¯·æä¾›å®¢æˆ·çš„è´¦æˆ· ID",
    });
    return new Command({
      update: { customerId: userInput.customerId },
      goto: "lookupCustomer",
    });
  }
  // ç»§ç»­å¤„ç†...
};
```

### 4. æ„å¤–é”™è¯¯ï¼šç›´æ¥æŠ›å‡º

```typescript
const sendReply: GraphNode<typeof State> = async (state) => {
  try {
    await emailService.send(state.responseText);
  } catch (error) {
    throw error;  // è®©å¼€å‘è€…å»ä¿®
  }
};
```

---

## çœŸå®åœºæ™¯æ¡ˆä¾‹

### åœºæ™¯ 1ï¼šç®€å•é—®é¢˜ï¼ˆå…¨è‡ªåŠ¨ï¼‰

> ç”¨æˆ·ï¼š"æ€ä¹ˆé‡ç½®å¯†ç ï¼Ÿ"

```
è¯»é‚®ä»¶ â†’ åˆ†ç±»(é—®é¢˜ç±») â†’ æŸ¥FAQæ–‡æ¡£ â†’ èµ·è‰å›å¤ â†’ ç›´æ¥å‘é€
```

å…¨ç¨‹è‡ªåŠ¨ï¼Œ3 ç§’æå®šã€‚

### åœºæ™¯ 2ï¼šç´§æ€¥é—®é¢˜ï¼ˆäººå·¥ä»‹å…¥ï¼‰

> ç”¨æˆ·ï¼š"æˆ‘è¢«æ‰£äº†ä¸¤æ¬¡é’±ï¼ï¼ï¼"

```
è¯»é‚®ä»¶ â†’ åˆ†ç±»(ç´§æ€¥+è´¦å•) â†’ ã€æš‚åœç­‰ä¸»ç®¡ã€‘
                                    â”‚
ä¸»ç®¡ä¸Šçº¿ â†’ å®¡æ ¸/ä¿®æ”¹å›å¤ â†’ æ¢å¤å‘é€
```

ç³»ç»Ÿä¸ä¼šå‚»å‚»åœ°è‡ªåŠ¨å›å¤æ•æ„Ÿé—®é¢˜ï¼Œè€Œæ˜¯ç­‰äººå·¥ä»‹å…¥ã€‚

### åœºæ™¯ 3ï¼šæœåŠ¡å™¨æ•…éšœæ¢å¤

> æ­£åœ¨æŸ¥æ–‡æ¡£æ—¶ï¼Œæ•°æ®åº“å®•æœºäº†

```
è¯»é‚®ä»¶ [å­˜æ¡£] â†’ åˆ†ç±» [å­˜æ¡£] â†’ æŸ¥æ–‡æ¡£ [å¤±è´¥ï¼]
                                     â”‚
                            æœåŠ¡å™¨æ¢å¤å
                                     â”‚
                            ä»"æŸ¥æ–‡æ¡£"é‡è¯•ï¼ˆä¸ç”¨ä»å¤´æ¥ï¼‰
```

è¿™å°±æ˜¯ Checkpointer çš„å¨åŠ›ã€‚

---

## è®¾è®¡åŸåˆ™æ€»ç»“

### åŸåˆ™ 1ï¼šä¸€ä¸ªèŠ‚ç‚¹åªå¹²ä¸€ä»¶äº‹

**å¥½å¤„ï¼š**
- è°ƒè¯•æ–¹ä¾¿ï¼ˆçŸ¥é“æ˜¯å“ªä¸ªç¯èŠ‚å‡ºé—®é¢˜ï¼‰
- æ¢å¤ç²¾ç¡®ï¼ˆä¸ç”¨é‡åšå·²å®Œæˆçš„å·¥ä½œï¼‰
- å¯å¤ç”¨ï¼ˆåŒä¸€ä¸ªæŸ¥æ–‡æ¡£èŠ‚ç‚¹å¯ä»¥ç”¨åœ¨å¤šä¸ªæµç¨‹ï¼‰

### åŸåˆ™ 2ï¼šState åªå­˜åŸå§‹æ•°æ®

**å¥½å¤„ï¼š**
- çµæ´»æ ¼å¼åŒ–ï¼ˆä¸åŒèŠ‚ç‚¹å¯ä»¥ç”¨ä¸åŒæ–¹å¼å±•ç¤ºåŒä¸€æ•°æ®ï¼‰
- ä¾¿äºè°ƒè¯•ï¼ˆçœ‹åˆ°çš„æ˜¯åŸå§‹æ•°æ®ï¼Œä¸æ˜¯åŠ å·¥åçš„æç¤ºè¯ï¼‰
- æ˜“äºæ¼”è¿›ï¼ˆæ”¹æç¤ºè¯ä¸ç”¨æ”¹çŠ¶æ€ç»“æ„ï¼‰

### åŸåˆ™ 3ï¼šèŠ‚ç‚¹è‡ªå·±å†³å®šä¸‹ä¸€æ­¥

**å¥½å¤„ï¼š**
- é€»è¾‘å†…èšï¼ˆåˆ†ç±»é€»è¾‘å’Œè·¯ç”±é€»è¾‘æ”¾ä¸€èµ·ï¼‰
- å›¾ç»“æ„ç®€æ´ï¼ˆä¸ç”¨ç”»ä¸€å †æ¡ä»¶è¾¹ï¼‰
- å¯è¿½è¸ªï¼ˆçœ‹èŠ‚ç‚¹ä»£ç å°±çŸ¥é“å®ƒèƒ½å»å“ªï¼‰

---

## ä¸€å›¾æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LangGraph 5 æ­¥æ–¹æ³•è®º                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   Step 1: ç”»æµç¨‹å›¾                                          â”‚
â”‚       â†“                                                     â”‚
â”‚   Step 2: è¯†åˆ«èŠ‚ç‚¹ç±»å‹ï¼ˆLLM/æ•°æ®/åŠ¨ä½œ/äººå·¥ï¼‰                   â”‚
â”‚       â†“                                                     â”‚
â”‚   Step 3: è®¾è®¡ Stateï¼ˆåªå­˜åŸå§‹æ•°æ®ï¼‰                          â”‚
â”‚       â†“                                                     â”‚
â”‚   Step 4: å®ç°èŠ‚ç‚¹å‡½æ•°ï¼ˆCommand æ§åˆ¶è·¯ç”±ï¼‰                     â”‚
â”‚       â†“                                                     â”‚
â”‚   Step 5: è¿æ¥æˆå›¾ï¼ˆaddEdge + compileï¼‰                      â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      é”™è¯¯å¤„ç†ç­–ç•¥                             â”‚
â”‚                                                             â”‚
â”‚   çŸ­æš‚é”™è¯¯ â”€â”€> retryPolicyï¼ˆè‡ªåŠ¨é‡è¯•ï¼‰                        â”‚
â”‚   LLM é”™è¯¯ â”€â”€> å­˜è¿› Stateï¼Œè®© AI çœ‹åˆ°                        â”‚
â”‚   éœ€è¦äººå·¥ â”€â”€> interrupt()ï¼ˆæš‚åœç­‰å¾…ï¼‰                        â”‚
â”‚   æ„å¤–é”™è¯¯ â”€â”€> throwï¼ˆå¼€å‘è€…ä¿®å¤ï¼‰                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒè¦ç‚¹å›é¡¾

1. **5 æ­¥æ–¹æ³•è®º**ï¼šç”»å›¾ â†’ è¯†åˆ«ç±»å‹ â†’ è®¾è®¡ State â†’ å®ç°èŠ‚ç‚¹ â†’ è¿æ¥æˆå›¾
2. **èŠ‚ç‚¹åŸåˆ™**ï¼šæ¯ä¸ªèŠ‚ç‚¹åªåšä¸€ä»¶äº‹ï¼Œé€šè¿‡ Command å†³å®šä¸‹ä¸€æ­¥
3. **çŠ¶æ€åŸåˆ™**ï¼šåªå­˜åŸå§‹æ•°æ®ï¼Œåœ¨èŠ‚ç‚¹å†…æŒ‰éœ€æ ¼å¼åŒ–
4. **é”™è¯¯å››è±¡é™**ï¼šä¸åŒé”™è¯¯ä¸åŒå¤„ç†ï¼Œè®©å¯¹çš„äºº/ç³»ç»Ÿä¿®å¯¹çš„é”™è¯¯
5. **æ ¸å¿ƒæ€æƒ³**ï¼šåˆ†è€Œæ²»ä¹‹ï¼Œè®©å¤æ‚ç³»ç»Ÿå˜å¾—å¯æ§ã€å¯è°ƒè¯•ã€å¯æ¢å¤

---

## ä¸‹ä¸€æ­¥å­¦ä¹ 

æŒæ¡äº†æ€ç»´æ¨¡å¼ï¼Œæ¥ä¸‹æ¥æ·±å…¥ APIï¼š

- ğŸ”§ **[06-Graph API è¯¦è§£](./06-graph-api.md)**ï¼šStateGraph æ ¸å¿ƒ API å®Œå…¨æŒ‡å—
- ğŸ¯ **[07-Functional API](./07-functional-api.md)**ï¼šå¦ä¸€ç§ç¼–ç¨‹é£æ ¼
- ğŸ”„ **[08-å·¥ä½œæµä¸ Agent](./08-workflows.md)**ï¼š6 ç§æ ¸å¿ƒå·¥ä½œæµæ¨¡å¼

---

> ğŸ“… æ›´æ–°æ—¶é—´ï¼š2026-02-22
